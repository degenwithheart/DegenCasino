import{R as i,j as e}from"./three-DV31HySq.js";import{aJ as U,G as d,aI as _,aL as z,aK as K,an as V,bf as J,aM as X,aN as Y,aV as q,aW as Q,B as D,d as Z}from"./index-BarUt2o_.js";import{G as tt}from"./GameStatsHeader-DfbFCrGS.js";import{W as et,C as ot,S as st,a as at,b as nt,L as rt,c as it,d as ct,e as lt,f as ut,M as mt,R as pt}from"./win-C3lEYgs3.js";import{u as P}from"./useGameMeta-C4Hfe5lB.js";import{m as xt}from"./deterministicRng-BQgZTO1k.js";import{G as dt}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";const gt=Z.div`
  display: flex;
  align-items: center;
  gap: 24px;
  
  @media (max-width: 800px) {
    display: none;
  }
`;function It(){const[c,g]=U(),[s,y]=i.useState(0),[W,b]=i.useState(0),[yt,k]=i.useState(0),[a,R]=i.useState("idle"),[A,M]=i.useState(!1),[N,w]=i.useState(0),I=d.useGame(),S=_(),h=z({music:st,crash:ot,win:et}),f=50,j=i.useMemo(()=>S.maxPayout/f,[S.maxPayout]),L=c*f>S.maxPayout;i.useEffect(()=>{c>j&&g(j)},[j,c,g]);const{settings:m}=K(),{mobile:O}=V(),C=J("crash"),l=i.useRef(null),$=()=>{const t=Math.min((a==="idle"||a==="climbing"?s:W)/f,1),r=20,o=30,p=t*(100-r),x=Math.pow(t,5)*(100-o),H=(1-Math.pow(t,2.3))*90;return{bottom:`${x}%`,left:`${p}%`,transform:`rotate(${H}deg)`}},B=n=>{const t=Math.min(n/f,1);return(1-Math.pow(t,2.3))*90},E=(n,t,r,o)=>{const x=.01*(Math.floor(n)+1),u=n+x;if(y(u),u>=t){if(h.sounds.music.player.stop(),o)h.play("win"),R("win"),b(t),y(t),console.log(`ðŸš€ CRASH WIN! Rocket reached ${t.toFixed(2)}x and won!`),l.current?.winFlash(),l.current?.particleBurst(70,30,void 0,12),l.current?.screenShake(1,600);else{console.log(`ðŸ’¥ ROCKET EXPLODING at ${t.toFixed(2)}x`);const G=B(t);w(G),M(!0),h.play("crash"),R("crash"),b(t),y(t),console.log(`ðŸ’¥ CRASH! Rocket exploded at ${t.toFixed(2)}x`),l.current?.loseFlash(),l.current?.particleBurst(70,30,void 0,20),l.current?.screenShake(2,800),setTimeout(()=>{M(!1)},1e3)}return}setTimeout(()=>E(u,t,r,o),50)},T=a==="crash"?"#ff0000":a==="win"?"#00ff00":a==="climbing"?"#ffaa00":"#ffffff",v=n=>{const t=Math.floor(n*1e3);return D.crashgame.getCrashMultiplier(t)},F=async()=>{if(c<=0){console.error("âŒ BLOCKED: Cannot play with zero wager");return}R("climbing"),y(1),b(0),k(0),M(!1),w(0);const n=D.crashgame.calculateBetArray();await I.play({wager:c,bet:n});const t=await I.result(),r=t.payout,o=r>0?r/c:0,p=r>0,x=xt(`climb:${t.resultIndex}:${r}`),u=p?o:v(x());k(o),console.log("Final multiplier:",u.toFixed(2)+"x"),console.log("Win multiplier:",o.toFixed(2)+"x"),console.log("Is winner:",p),C.updateStats(t.payout),h.play("music"),E(1,u,o,p)};return e.jsxs(e.Fragment,{children:[e.jsx(d.Portal,{target:"recentplays",children:e.jsx(dt,{gameId:"crash"})}),e.jsx(d.Portal,{target:"stats",children:e.jsx(tt,{gameName:"Crash",gameMode:"Auto-Climb",rtp:"96",stats:C.stats,onReset:C.resetStats,isMobile:O})}),e.jsxs(d.Portal,{target:"screen",children:[e.jsxs(at,{children:[e.jsx(nt,{enableMotion:m.enableMotion,style:{opacity:s>3?0:1}}),e.jsx(rt,{enableMotion:m.enableMotion,style:{opacity:s>3?1:0}}),e.jsx(it,{enableMotion:m.enableMotion,style:{opacity:s>2?0:1}}),e.jsx(ct,{enableMotion:m.enableMotion,style:{opacity:s>2?1:0}}),e.jsx(lt,{enableMotion:m.enableMotion,style:{opacity:s>1?0:1}}),e.jsx(ut,{enableMotion:m.enableMotion,style:{opacity:s>1?1:0}}),e.jsxs(mt,{color:T,children:[s.toFixed(2),"x"]}),e.jsx(pt,{style:$(),isExploding:A,initialRotation:N})]}),e.jsx(X,{ref:l,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3},...P("crash")&&{title:P("crash").name,description:P("crash").description}})]}),e.jsxs(d.Portal,{target:"controls",children:[e.jsx(Y,{wager:c,setWager:g,onPlay:F,playDisabled:L||a==="climbing",playText:a==="climbing"?"Climbing...":"Launch Rocket"}),e.jsxs(gt,{children:[e.jsx(q,{value:c,onChange:g}),e.jsx(Q,{onClick:F,disabled:L||a==="climbing",children:a==="climbing"?"Climbing...":"Launch Rocket"})]})]})]})}export{It as default};
