import{R as f,j as o}from"./three-DV31HySq.js";import{aC as ke,G as C,aH as Ie,aI as We,aJ as Ee,aK as Be,an as Me,aL as _e,aM as Ne,T as Le,aN as ae,aO as re,aP as Ge,aW as ce,B as Oe}from"./index-BarUt2o_.js";import{u as De}from"./useGameMeta-C4Hfe5lB.js";import{G as Fe}from"./GameStatsHeader-DfbFCrGS.js";import{G as Ye}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{G as ze}from"./GameControlsSection-BZ3LzTmM.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";const Ue="/assets/lose-Cc6USioj.mp3",Ve="/assets/start-BA7xmUQB.mp3",Xe="/assets/win-BA92bcBv.mp3",$e="/assets/win-BA92bcBv.mp3",Ke="/assets/start-BA7xmUQB.mp3",p=1200,R=800,v=1e3,A=500,a=100,P=60,U=2,x=40,B=30,de=2,fe=1,ge=50,qe=.2,s={gold:"#d4a574",crimson:"#b8336a",purple:"#8b5a9e",background:"#0a0511",light:"#f4e9e1",dark:"#1a1a1a",track:"#2d5016",grass:"#4a7c32",dirt:"#8b4513",nothing:"#ff4444"},r=[{name:"Lightning Bolt",color:"#ffff00",odds:"10:1",description:"The fastest in the west",emoji:"‚ö°"},{name:"Thunder Strike",color:"#ff6600",odds:"8:1",description:"Strikes like lightning",emoji:"‚õàÔ∏è"},{name:"Wind Runner",color:"#00ccff",odds:"6:1",description:"Swift as the wind",emoji:"üí®"},{name:"Fire Storm",color:"#ff3300",odds:"4.5:1",description:"Burns up the competition",emoji:"üî•"},{name:"Ocean Wave",color:"#0066cc",odds:"3.5:1",description:"Fluid and powerful",emoji:"üåä"},{name:"Mountain Peak",color:"#999999",odds:"2.8:1",description:"Solid and reliable",emoji:"üèîÔ∏è"},{name:"Solar Flare",color:"#ff9900",odds:"2.2:1",description:"Bright and burning",emoji:"‚òÄÔ∏è"},{name:"Lunar Eclipse",color:"#6600cc",odds:"1.8:1",description:"Mysterious and dark",emoji:"üåô"}],Qe=20,ue=1,pe=2;function ct(){const he=ke({gameName:"Virtual Horse Racing",description:"Bet on virtual horses and watch them race to the finish! Pick your favorite and experience the thrill of the track",rtp:97,maxWin:"100x"}),V=C.useGame(),me=Ie(),T=We(),[S,X]=Ee(),{settings:Je}=Be(),L=f.useRef(null),{mobile:$}=Me(),G=_e({win:Xe,lose:Ue,play:Ve,gallop:$e,finish:Ke}),M=f.useRef(null),H=f.useRef(),k=f.useRef([]),[y,I]=f.useState("betting"),[c,K]=f.useState(null),[q,_]=f.useState([]),[h,Q]=f.useState(null),[O,J]=f.useState(0),[Z,ee]=f.useState(!1),[te,D]=f.useState(null),[ye,ne]=f.useState(0),[Se,oe]=f.useState(0),[be,se]=f.useState(0),[Ze,F]=f.useState(0),[Y,N]=f.useState(null);f.useMemo(()=>T?.liquidity?Number(T.liquidity):0,[T]),f.useEffect(()=>{const e=r.map((t,n)=>({x:a,y:a+n*(P+U)+P/2,speed:de+Math.random()*fe,lane:n,finished:!1,finishTime:0,gallopFrame:Math.random()*Math.PI*2}));_(e)},[]);const le=(e,t,n,i=Qe)=>{const l=[];for(let g=0;g<i;g++)l.push({x:e,y:t,vx:(Math.random()-.5)*ue*2,vy:(Math.random()-.5)*ue*2,life:0,maxLife:60+Math.random()*60,color:n,size:pe+Math.random()*pe});k.current=[...k.current,...l]},Re=e=>{const t=e.createRadialGradient(p/2,R/2,0,p/2,R/2,p/2);t.addColorStop(0,s.background),t.addColorStop(.7,"#1a0520"),t.addColorStop(1,"#0a0511"),e.fillStyle=t,e.fillRect(0,0,p,R),e.fillStyle=s.grass,e.fillRect(0,0,p,a),e.fillRect(0,a+A,p,R-a-A)},je=e=>{e.fillStyle=s.track,e.fillRect(a,a,v,A),e.strokeStyle=s.light+"40",e.lineWidth=1;for(let i=1;i<r.length;i++){const l=a+i*(P+U);e.beginPath(),e.moveTo(a,l),e.lineTo(a+v,l),e.stroke()}e.strokeStyle=s.light,e.lineWidth=3,e.beginPath(),e.moveTo(a,a),e.lineTo(a,a+A),e.stroke();const t=a+v-ge;e.strokeStyle=s.gold,e.lineWidth=4,e.setLineDash([10,10]),e.beginPath(),e.moveTo(t,a),e.lineTo(t,a+A),e.stroke(),e.setLineDash([]);const n=10;for(let i=a;i<a+A;i+=n)for(let l=t-5;l<t+5;l+=n){const g=((l-t+5)/n+(i-a)/n)%2<1;e.fillStyle=g?"#000000":"#ffffff",e.fillRect(l,i,n,n)}},ve=e=>{q.forEach((t,n)=>{const i=r[n],l=c===n,g=Y===n,u=h===n;(l||g)&&(e.fillStyle=l?s.gold+"40":s.light+"20",e.fillRect(t.x-x/2-5,t.y-P/2,x+10,P)),u&&y==="finished"&&(e.shadowColor=s.gold,e.shadowBlur=20),e.fillStyle=i.color,e.fillRect(t.x-x/2,t.y-B/2,x,B);const d=Math.sin(t.gallopFrame)*3;e.fillStyle=i.color,e.fillRect(t.x+x/4,t.y+B/2,3,8+d),e.fillRect(t.x-x/4,t.y+B/2,3,8-d),e.shadowColor="transparent",e.shadowBlur=0,e.fillStyle=s.light,e.font="bold 16px Arial",e.textAlign="center",e.fillText((n+1).toString(),t.x,t.y+5),y==="racing"&&!t.finished&&le(t.x-x/2,t.y+B/2,s.dirt,2)}),e.textAlign="left"},Ae=e=>{const t=a+v+20,n=a,i=p-t-20,l=A;e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(t,n,i,l),e.fillStyle=s.gold,e.font="bold 20px Arial",e.textAlign="center",e.fillText("Select Your Horse",t+i/2,n+30),r.forEach((g,u)=>{const d=n+50+u*60,m=c===u;(m||Y===u)&&(e.fillStyle=m?s.gold+"20":s.light+"10",e.fillRect(t+10,d-25,i-20,50)),e.fillStyle=g.color,e.fillRect(t+20,d-15,20,20),e.fillStyle=s.light,e.font="bold 14px Arial",e.textAlign="left",e.fillText(`${u+1}. ${g.name}`,t+50,d-5),e.font="12px Arial",e.fillStyle=s.gold,e.fillText(`${g.odds} ${g.emoji}`,t+50,d+10)}),e.textAlign="left"},Pe=e=>{let t="",n=s.light;switch(y){case"betting":t="Select a horse to bet on",n=s.gold;break;case"starting":t="Horses are lining up...",n=s.purple;break;case"racing":t="And they're off!",n=s.crimson;break;case"finished":h!==null&&(t=`${r[h].name} wins! ${r[h].emoji}`,n=r[h].color);break;case"celebrating":t=c===h?"You won! üéâ":"Better luck next time",n=c===h?s.gold:s.nothing;break}const i=e.measureText(t).width;if(e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(p/2-i/2-20,20,i+40,50),e.fillStyle=n,e.font="bold 24px Arial",e.textAlign="center",e.fillText(t,p/2,50),e.textAlign="left",y==="racing"){const u=(p-300)/2,d=R-100;e.fillStyle=s.dark,e.fillRect(u,d,300,10),e.fillStyle=s.gold,e.fillRect(u,d,300*O,10),e.fillStyle=s.light,e.font="14px Arial",e.textAlign="center",e.fillText(`Race Progress: ${Math.round(O*100)}%`,p/2,d-10)}},xe=e=>{k.current.forEach((t,n)=>{if(t.x+=t.vx,t.y+=t.vy,t.life++,t.life>=t.maxLife){k.current.splice(n,1);return}const i=1-t.life/t.maxLife;e.fillStyle=t.color+Math.floor(i*255).toString(16).padStart(2,"0"),e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill()})},Te=()=>{const e=M.current;if(!e)return;const t=e.getContext("2d");t&&(t.clearRect(0,0,p,R),Re(t),je(t),ve(t),y==="betting"&&Ae(t),Pe(t),xe(t))};f.useEffect(()=>{const e=()=>{_(t=>t.map(n=>({...n,gallopFrame:n.gallopFrame+qe}))),Te(),H.current=requestAnimationFrame(e)};return e(),()=>{H.current&&cancelAnimationFrame(H.current)}},[y,c,q,h,O,Y]);const we=e=>{if(y!=="betting"||Z)return;const t=M.current;if(!t)return;const n=t.getBoundingClientRect(),i=p/n.width,l=R/n.height,g=(e.clientX-n.left)*i,u=(e.clientY-n.top)*l,d=a+v+20,m=a,w=p-d-20;if(g>=d&&g<=d+w)for(let b=0;b<r.length;b++){const j=m+50+b*60;if(u>=j-25&&u<=j+25){K(b),ie();break}}},Ce=e=>{if(y!=="betting"){N(null);return}const t=M.current;if(!t)return;const n=t.getBoundingClientRect(),i=p/n.width,l=R/n.height,g=(e.clientX-n.left)*i,u=(e.clientY-n.top)*l,d=a+v+20,m=a,w=p-d-20;if(g>=d&&g<=d+w){let b=null;for(let j=0;j<r.length;j++){const E=m+50+j*60;if(u>=E-25&&u<=E+25){b=j;break}}N(b)}else N(null)};f.useMemo(()=>{if(!T?.maxPayout||!S||S===0)return 100;const e=T.maxPayout/S;return Math.min(e*.9,100)},[T?.maxPayout,S]),De("fancyvirtualhorseracing-v2");const ie=async()=>{if(c!==null){ee(!0),I("starting");try{G.play("play");const e=Oe["fancyvirtualhorseracing-v2"].calculateBetArray();await V.play({wager:S,bet:e});const t=await V.result(),n=t.payout>0;D(n?t.payout:null),ne(l=>l+1),n?(oe(l=>l+1),F(l=>l+(t.payout-S))):(se(l=>l+1),F(l=>l-S));const i=n?c:(c+1)%r.length;Q(i),setTimeout(()=>{I("racing"),G.play("gallop");const l=setInterval(()=>{J(g=>{const u=g+.02;return _(d=>d.map((m,w)=>{if(m.finished)return m;const b=a+v-ge;if(b-m.x<=0)return{...m,x:b,finished:!0,finishTime:Date.now()};let E=m.speed;return w===i&&u>.7&&(E*=1.2),{...m,x:m.x+E}})),u>=1&&(clearInterval(l),I("finished"),G.play("finish"),setTimeout(()=>{I("celebrating"),n?(L.current?.triggerWin(),le(p/2,R/2,r[i].color,100)):L.current?.triggerLoss(),setTimeout(()=>{W()},3e3)},1e3)),u})},100)},2e3)}catch(e){console.error("Game error:",e),W()}}},W=()=>{I("betting"),K(null),Q(null),J(0),ee(!1),D(null),k.current=[];const e=r.map((t,n)=>({x:a,y:a+n*(P+U)+P/2,speed:de+Math.random()*fe,lane:n,finished:!1,finishTime:0,gallopFrame:Math.random()*Math.PI*2}));_(e)};f.useEffect(()=>()=>{H.current&&cancelAnimationFrame(H.current)},[]);const z=Z||me.isPlaying,He=!z&&S>0;return o.jsxs(o.Fragment,{children:[he,o.jsx(C.Portal,{target:"recentplays",children:o.jsx(Ye,{gameId:"fancyvirtualhorseracing-v2"})}),o.jsx(C.Portal,{target:"stats",children:o.jsx(Fe,{gameName:"Virtual Horse Racing",gameMode:"V2",rtp:"95",stats:{gamesPlayed:ye,wins:Se,losses:be},onReset:()=>{ne(0),oe(0),se(0),F(0),D(null)}})}),o.jsx(C.Portal,{target:"screen",children:o.jsx(C.Responsive,{children:o.jsxs(Ne,{ref:L,children:[o.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx("canvas",{ref:M,width:p,height:R,onClick:we,onMouseMove:Ce,onMouseLeave:()=>N(null),style:{border:`2px solid ${s.gold}`,borderRadius:"8px",background:s.background,cursor:y==="betting"&&!z?"pointer":"default"}}),y==="celebrating"&&o.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.9)",borderRadius:"16px",padding:"32px",textAlign:"center",color:c===h?s.gold:s.nothing,border:`2px solid ${c===h?s.gold:s.nothing}`,backdropFilter:"blur(10px)"},children:[o.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",marginBottom:"16px"},children:c===h?"üèÜ You Won!":"üí∏ Better Luck Next Time"}),h!==null&&o.jsxs("div",{style:{fontSize:"20px",color:s.light,marginBottom:"16px"},children:["Winner: ",r[h].name," ",r[h].emoji]}),te&&o.jsxs("div",{style:{fontSize:"18px",color:s.gold,fontWeight:"bold"},children:["Won: ",o.jsx(Le,{amount:te})]})]})]}),o.jsx(ze,{children:$?o.jsx(ae,{wager:S,setWager:X,onPlay:()=>{},hideWager:!0,hideMessage:"Select a Horse Above! üêé",children:c!==null&&o.jsxs("div",{style:{background:"rgba(212, 165, 116, 0.1)",borderRadius:"8px",padding:"16px",marginBottom:"16px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[o.jsx("span",{style:{color:s.light,fontWeight:"bold"},children:"Selected Horse"}),o.jsxs("span",{style:{color:r[c].color,fontSize:"18px",fontWeight:"bold"},children:[r[c].name," ",r[c].emoji]})]}),o.jsxs("div",{style:{color:s.gold,fontSize:"14px"},children:["Odds: ",r[c].odds]})]})}):o.jsxs(re,{children:[" ",o.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"center",flexWrap:"wrap"},children:[c===null?o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"20px",color:"#ffd700",fontSize:"18px",fontWeight:"700",textShadow:"0 2px 4px rgba(0, 0, 0, 0.5)",minWidth:"200px"},children:"Select a Horse Above! üêé"}):o.jsxs("div",{style:{background:"rgba(212, 165, 116, 0.1)",borderRadius:"8px",padding:"12px",minWidth:"200px"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},children:[o.jsx("span",{style:{color:s.light,fontSize:"14px",fontWeight:"bold"},children:"Selected"}),o.jsxs("span",{style:{color:r[c].color,fontSize:"16px",fontWeight:"bold"},children:[r[c].name," ",r[c].emoji]})]}),o.jsxs("div",{style:{color:s.gold,fontSize:"12px"},children:["Odds: ",r[c].odds]})]}),y!=="betting"&&o.jsx(Ge,{onClick:W,children:"New Race"})]})]})})]})})}),o.jsx(C.Portal,{target:"controls",children:$?o.jsx(ae,{wager:S,setWager:X,onPlay:ie,playDisabled:!He,playText:z?"Racing...":"Start Race",children:y!=="betting"&&o.jsx(ce,{onClick:W,children:"New Race"})}):o.jsx(re,{children:y!=="betting"&&o.jsx(ce,{onClick:W,children:"New Race"})})})]})}export{ct as default};
