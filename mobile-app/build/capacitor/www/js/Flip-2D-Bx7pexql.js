import{R as l,j as t}from"./three-DV31HySq.js";import{G as F,aH as Ee,aI as Ge,aJ as Ne,aK as De,an as Le,aL as He,bf as _e,aM as Oe,aN as Be,aO as Ue,aV as qe,B as L}from"./index-BarUt2o_.js";import{m as Ye}from"./deterministicRng-BQgZTO1k.js";import{u as $e}from"./useGameMeta-C4Hfe5lB.js";import{G as Ve}from"./GameStatsHeader-DfbFCrGS.js";import{F as H,R as Xe,C as h,a as b,H as Ke,T as Je}from"./tails-DytXLX_g.js";import{S as Qe,a as Ze,b as et,c as tt}from"./play-BNe00jeK.js";import{G as at}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{G as nt}from"./GameControlsSection-BZ3LzTmM.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";function St(){const $=F.useGame(),V=Ee(),j=Ge(),[E,X]=Ne(),{settings:y}=De(),{mobile:de}=Le(),A=l.useRef(null),_=He({win:tt,lose:et,coin:Ze,play:Qe}),O=l.useRef(null),W=l.useRef(),[w,fe]=l.useState("heads"),[p,K]=l.useState(1),[C,J]=l.useState(1),[pe,Q]=l.useState(0),[ue,ge]=l.useState(0),[st,he]=l.useState(0),[ot,me]=l.useState(0),[it,Z]=l.useState(!1),[ee,be]=l.useState(!1),[x,te]=l.useState(!1),[ae,xe]=l.useState(Array(H.MAX_COINS).fill(0)),[ne,se]=l.useState({particles:[]}),G=_e("flip-v2"),N=y.quality==="ultra"?50:y.quality==="high"?30:y.quality==="medium"?15:0,[B,ye]=l.useState(null),[U,Se]=l.useState(null),q=l.useCallback((e,u,c)=>{if(!y.enableEffects||N===0)return;const n=[];for(let m=0;m<N;m++)n.push({x:e,y:u,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10-5,life:60+Math.random()*60,maxLife:120,color:c,size:2+Math.random()*4});se(m=>({...m,particles:[...m.particles,...n]}))},[y.enableEffects,N]);l.useEffect(()=>{if(!y.enableMotion)return;const u=setInterval(()=>{se(c=>({...c,particles:c.particles.map(n=>({...n,x:n.x+n.vx,y:n.y+n.vy,life:n.life-1,vy:n.vy+.1})).filter(n=>n.life>0)}))},16);return()=>clearInterval(u)},[y.enableMotion]),l.useEffect(()=>{(async()=>{const u=new Image;u.src=Ke,await new Promise(n=>{u.onload=n}),ye(u);const c=new Image;c.src=Je,await new Promise(n=>{c.onload=n}),Se(c)})()},[]);const[oe,ie]=l.useState(Array(H.MAX_COINS).fill(null).map(()=>({rotation:0,scale:1,y:0,showing:"heads"})));l.useEffect(()=>{if(!x)return;(()=>{const c=performance.now(),n=m=>{const s=m-c,i=Math.min(s/2e3,1);ie(S=>S.map((v,a)=>{if(a>=p)return v;const o=8+a%4*2,d=i*o*360,r=1+Math.sin(i*Math.PI*2)*.3,M=Math.sin(i*Math.PI*4)*30,g=d%360,f=g>90&&g<270?"tails":"heads";return{rotation:d,scale:r,y:M,showing:f}})),i<1?requestAnimationFrame(n):ie(S=>S.map((v,a)=>a>=p?v:{...v,rotation:0,scale:1,y:0,showing:ae[a]===1?"heads":"tails"}))};requestAnimationFrame(n)})()},[x,ae,p]);const Me=e=>{const n=b-140-160,m=h-120;if(B&&U){const s=O.current;if(s){const i=s.getBoundingClientRect(),S=i.width/i.height,v=h/b;let a,o,d,r,M;const g=m-40,f=n-40;if(p<=4){o=Math.min(p,4),d=1;const I=Math.min(g/o*.8,f*.9);a=Math.min(500,I),r=(g-o*a)/Math.max(1,o-1),M=0}else if(p<=8){o=4,d=2;const I=Math.min(g/o*.85,f/d*.85);a=Math.min(500,I),r=(g-o*a)/(o-1),M=(f-d*a)/(d-1)}else if(p<=12){o=4,d=3;const I=Math.min(g/o*.9,f/d*.9);a=Math.min(500,I),r=(g-o*a)/(o-1),M=(f-d*a)/(d-1)}else if(p<=16){o=4,d=4;const I=Math.min(g/o*.95,f/d*.95);a=Math.min(500,I),r=(g-o*a)/(o-1),M=(f-d*a)/(o-1)}else{o=5,d=4;const I=Math.min(g/o*.95,f/d*.95);a=Math.min(500,I),r=(g-o*a)/(o-1),M=(f-d*a)/(d-1)}const P=o*a+(o-1)*r,Ae=d*a+(d-1)*M,Pe=60+(m-P)/2,je=140+(n-Ae)/2;for(let I=0;I<p;I++){const We=I%o,Re=Math.floor(I/o),ke=Pe+We*(a+r)+a/2,Te=je+Re*(a+M)+a/2,T=oe[I];e.save(),e.translate(ke,Te+T.y);const ze=v/S;e.scale(T.scale*ze,T.scale),e.rotate(T.rotation*Math.PI/180);const Fe=T.showing==="heads"?B:U,D=document.createElement("canvas");D.width=a,D.height=a;const z=D.getContext("2d");z.beginPath(),z.arc(a/2,a/2,a/2,0,Math.PI*2),z.closePath(),z.clip(),z.drawImage(Fe,0,0,a,a),e.drawImage(D,-a/2,-a/2),e.restore()}}}e.restore()},Ie=()=>{const e=L["flip-v2"];e.calculateBetArray(p,C,w);const u=e.probAtLeast(p,C);return e.computeMultiplier(u)},R=()=>L["flip-v2"].probAtLeast(p,C),Y=l.useMemo(()=>{const e=L["flip-v2"];let u=0;for(let c=1;c<=H.MAX_COINS;c++)for(let n=1;n<=c;n++){const m=e.probAtLeast(c,n),s=e.computeMultiplier(m);s>u&&(u=s)}return u},[]);l.useMemo(()=>j.maxPayout/Y,[j.maxPayout,Y]);const re=E*Y>j.maxPayout,Ce=e=>{const c=performance.now()*.001,n=e.createRadialGradient(h/2,b/2,0,h/2,b/2,Math.max(h,b)/2);n.addColorStop(0,"rgba(26, 26, 46, 0.2)"),n.addColorStop(.5,"rgba(22, 33, 62, 0.15)"),n.addColorStop(1,"rgba(15, 15, 35, 0.1)"),e.fillStyle=n,e.fillRect(0,0,h,b),e.save(),e.globalAlpha=.15,e.fillStyle="rgba(212, 165, 116, 0.3)",e.font="120px serif",e.textAlign="center",e.save(),e.translate(h*.12,b*.15),e.rotate(-15*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(255, 215, 0, 0.25)",e.font="100px serif",e.save(),e.translate(h*.88,b*.85),e.rotate(25*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(139, 90, 158, 0.2)",e.font="60px serif",e.save(),e.translate(h*.75,b*.25),e.rotate(45*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.save(),e.translate(h*.25,b*.75),e.rotate(-30*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(212, 165, 116, 0.15)",e.font="40px serif";const m=["ðŸª™","ðŸ’°","ðŸª™","ðŸ’°","ðŸª™","ðŸ’°"];for(let s=0;s<8;s++){const i=s*h/8+h/16,S=b*.3+Math.sin(s*.8)*60;e.save(),e.translate(i,S),e.rotate(s*45*Math.PI/180),e.fillText(m[s%m.length],0,0),e.restore()}if(e.restore(),y.enableEffects){e.strokeStyle="rgba(138, 43, 226, 0.3)",e.lineWidth=2;for(let s=0;s<8;s++){const i=y.enableMotion?(c*1+s*Math.PI/4)%(Math.PI*2):s*Math.PI/4,S=y.enableMotion?150+Math.sin(c*2+s)*50:150,v=h/2+Math.cos(i)*S,a=b/2+Math.sin(i)*S;e.beginPath(),e.arc(v,a,30+s*10,0,Math.PI*2),e.stroke()}}if(y.enableEffects){e.fillStyle="rgba(255, 215, 0, 0.6)",e.font="24px serif",e.textAlign="center";const s=["âœ¦","âœ§","âœ©","âœª","âœ«","âœ¬","âœ­","âœ®","âœ¯","âœ°"];for(let i=0;i<10;i++){const S=i*Math.PI/5,v=y.enableMotion?Math.sin(c*.1+i)*200+h/2:Math.cos(S)*200+h/2,a=y.enableMotion?Math.cos(c*.1+i)*150+b/2:Math.sin(S)*150+b/2;e.save(),e.translate(v,a);const o=y.enableMotion?c*1.5+i:i*.5;e.rotate(o),e.fillText(s[i%s.length],0,0),e.restore()}}y.enableEffects&&N>0&&ne.particles.forEach(s=>{const i=s.life/s.maxLife;e.save(),e.globalAlpha=i,e.fillStyle=s.color,e.beginPath(),e.arc(s.x,s.y,s.size,0,Math.PI*2),e.fill(),e.restore()})},ve=e=>{Me(e)},k=l.useCallback(()=>{const e=O.current;if(!e){W.current=requestAnimationFrame(k);return}const u=e.getContext("2d");if(!u){W.current=requestAnimationFrame(k);return}u.fillStyle=Xe.background,u.fillRect(0,0,h,b),Ce(u),ve(u),W.current=requestAnimationFrame(k)},[p,w,C,pe,ue,ee,x,oe,B,U,y.enableMotion,ne.particles]);l.useEffect(()=>(k(),()=>{W.current&&cancelAnimationFrame(W.current)}),[k]);const we=async()=>{if(!x){te(!0),Z(!0);try{const u=L["flip-v2"].calculateBetArray(p,C,w),c=E*p;await $.play({bet:u,wager:c,metadata:[p,C,w==="heads"?1:0]});const n=await $.result();_.play("coin");const m=n.payout>0,s=[],i=[],S=`${n.resultIndex}:${n.payout}:${n.multiplier}:${p}:${C}:${w}`,v=Ye(S);if(m){let r=0,M=0;for(let g=0;g<C;g++){const f=w==="heads";s.push(f),i.push(f?1:0),f?r++:M++}for(let g=C;g<p;g++){const f=v()<.5;s.push(f),i.push(f?1:0),f?r++:M++}}else{let r=0,M=0;const g=Math.min(C-1,p);for(let f=0;f<g;f++){const P=w==="heads";s.push(P),i.push(P?1:0),P?r++:M++}for(let f=g;f<p;f++){const P=w==="tails"?v()<.7:v()<.3;s.push(P),i.push(P?1:0),P?r++:M++}}xe(i);const o=s.filter(r=>r===(w==="heads")).length>=C;await new Promise(r=>setTimeout(r,1500));const d={won:m,results:s,winnings:n.payout-c};m?(A.current&&(n.multiplier>=3?(A.current.winFlash("#ffd700",3),setTimeout(()=>{A.current?.particleBurst(void 0,void 0,"#ffd700",80),A.current?.screenShake(3,1500),q(h/2,b/2,"#ffd700")},300)):(A.current.winFlash("#4caf50",2),setTimeout(()=>{A.current?.particleBurst(void 0,void 0,"#4caf50",40),q(h/2,b/2,"#4caf50")},200))),_.play("win"),Q(r=>r+d.winnings),he(r=>r+1),G.updateStats(d.winnings)):(A.current&&(A.current.loseFlash("#f44336",2),setTimeout(()=>{A.current?.screenShake(2,1e3),q(h/2,b/2,"#ff6b6b")},200)),_.play("lose"),Q(r=>r+d.winnings),me(r=>r+1),G.updateStats(0)),ge(r=>r+1),be(!0)}catch(e){console.error("Game error:",e)}finally{te(!1),Z(!1)}}},le=()=>x?"Flipping...":ee?"Again":"Flip",ce=()=>we;return $e("flip-v2"),t.jsxs(t.Fragment,{children:[t.jsx(F.Portal,{target:"recentplays",children:t.jsx(at,{gameId:"flip-v2"})}),t.jsx(F.Portal,{target:"stats",children:t.jsx(Ve,{gameName:"Flip",gameMode:"V2",rtp:"95",stats:G.stats,onReset:G.resetStats,isMobile:de})}),t.jsx(F.Portal,{target:"screen",children:t.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"linear-gradient(135deg, #0a0511 0%, #0d0618 25%, #0f081c 50%, #0a0511 75%, #0a0511 100%)",perspective:"100px"},children:[t.jsx("div",{style:{position:"absolute",top:"20px",left:"20px",right:"20px",bottom:"140px",borderRadius:"10px",border:"2px solid rgba(212, 165, 116, 0.4)",overflow:"hidden"},children:t.jsx("canvas",{ref:O,width:h,height:b,style:{width:"100%",height:"100%",imageRendering:"auto",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent"}})}),t.jsxs(nt,{children:[t.jsx("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(10, 5, 17, 0.9) 0%, rgba(139, 90, 158, 0.1) 50%, rgba(10, 5, 17, 0.9) 100%)",borderRadius:"12px",border:"2px solid rgba(212, 165, 116, 0.5)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"12px",boxShadow:"0 4px 16px rgba(10, 5, 17, 0.4), inset 0 1px 0 rgba(212, 165, 116, 0.2)",backdropFilter:"blur(10px)",position:"relative"},children:t.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"12px",width:"100%",alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[t.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"COINS"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("button",{onClick:()=>K(Math.max(1,p-1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#ffffff",minWidth:"16px",textAlign:"center"},children:p}),t.jsx("button",{onClick:()=>K(Math.min(H.MAX_COINS,p+1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[t.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"SIDE"}),t.jsx("button",{onClick:()=>fe(w==="heads"?"tails":"heads"),disabled:x,style:{padding:"2px 8px",borderRadius:"6px",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#ffffff",fontSize:"11px",fontWeight:"bold",cursor:x?"not-allowed":"pointer"},children:w.charAt(0).toUpperCase()+w.slice(1)})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[t.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"MIN SIDES"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[t.jsx("button",{onClick:()=>J(Math.max(1,C-1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#ffffff",minWidth:"16px",textAlign:"center"},children:C}),t.jsx("button",{onClick:()=>J(Math.min(p,C+1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]})]})}),t.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.15) 0%, rgba(245, 124, 0, 0.25) 50%, rgba(255, 152, 0, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(255, 152, 0, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(255, 152, 0, 0.2), inset 0 1px 0 rgba(255, 152, 0, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#ff9800",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"RISK"}),t.jsx("div",{style:{fontSize:"18px",color:R()>.7?"#4caf50":R()>.3?"#ff9800":"#f44336",fontWeight:"600"},children:R()>.7?"LOW":R()>.3?"MEDIUM":"HIGH"})]}),t.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(184, 51, 106, 0.15) 0%, rgba(136, 14, 79, 0.25) 50%, rgba(184, 51, 106, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(184, 51, 106, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(184, 51, 106, 0.2), inset 0 1px 0 rgba(184, 51, 106, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#b8336a",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"WIN CHANCE"}),t.jsxs("div",{style:{fontSize:"18px",color:"rgba(184, 51, 106, 0.9)",fontWeight:"600"},children:[(R()*100).toFixed(1),"%"]})]}),t.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.25) 50%, rgba(76, 175, 80, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(76, 175, 80, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(76, 175, 80, 0.2), inset 0 1px 0 rgba(76, 175, 80, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#4caf50",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"MULTIPLIER"}),t.jsx("div",{style:{fontSize:"18px",color:"rgba(76, 175, 80, 0.9)",fontWeight:"600"},children:`${Ie().toFixed(2)}x`})]})]}),t.jsx(Oe,{ref:A,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3}})]})}),t.jsxs(F.Portal,{target:"controls",children:[t.jsx(Be,{wager:E,setWager:X,onPlay:ce(),playDisabled:x||!j||V.isPlaying||re,playText:le()}),t.jsx(Ue,{onPlay:ce(),playDisabled:x||!j||V.isPlaying||re,playText:le(),children:t.jsx(qe,{value:E,onChange:X})})]})]})}export{St as default};
