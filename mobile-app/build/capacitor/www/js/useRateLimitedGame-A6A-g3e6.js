import{r}from"./three-DV31HySq.js";import{b3 as x}from"./index-BarUt2o_.js";function R(h,S={}){const{fetchMetadata:U=!0,updateInterval:f=5e3,criticalUpdatePhases:p=["settled","waiting"]}=S,{game:t,metadata:s}=x(h,{fetchMetadata:U}),[u,o]=r.useState({game:t,metadata:s,lastUpdated:Date.now(),isStale:!1}),i=r.useRef(null),n=r.useRef(null),m=r.useRef(!0),l=r.useCallback((e,a,d=!1)=>{o({game:e,metadata:a,lastUpdated:Date.now(),isStale:d})},[]),c=r.useCallback((e,a)=>!e||!a||!e.state||!a.state||e.state.waiting!==a.state.waiting||e.state.playing!==a.state.playing||e.state.settled!==a.state.settled||e.winnerIndexes!==a.winnerIndexes||e.players?.length!==a.players?.length||e.softExpirationTimestamp!==a.softExpirationTimestamp||e.hardExpirationTimestamp!==a.hardExpirationTimestamp,[]),g=r.useCallback(e=>e?.state?p.some(a=>e.state[a]):!1,[p]);return r.useEffect(()=>{if(!t)return;const a=Date.now()-u.lastUpdated;if(m.current){l(t,s,!1),i.current=t,m.current=!1;return}if(c(t,i.current)){l(t,s,!1),i.current=t;return}if(g(t)){l(t,s,!1),i.current=t;return}return a>f*2&&o(d=>({...d,isStale:!0})),n.current||(n.current=setInterval(()=>{t&&c(t,i.current)?(l(t,s,!1),i.current=t):l(t,s,!1)},f)),()=>{n.current&&(clearInterval(n.current),n.current=null)}},[t,s,u.lastUpdated,f,c,g,l]),r.useEffect(()=>()=>{n.current&&(clearInterval(n.current),n.current=null)},[]),{game:u.game,metadata:u.metadata,lastUpdated:u.lastUpdated,isStale:u.isStale,gambaGame:t,gambaMetadata:s}}export{R as u};
