import{R as r,r as $,j as e}from"./three-DV31HySq.js";import{G as N,aI as K,an as J,bf as q,aJ as Q,aK as X,aL as Z,aF as ee,aM as se,bo as te,aN as ae,aO as ne,aV as oe}from"./index-BarUt2o_.js";import{G as le}from"./GameStatsHeader-DfbFCrGS.js";import{u as _}from"./useGameMeta-C4Hfe5lB.js";import{S as re,a as ie,I as ce,R as me}from"./SlotsBackground.enhanced.styles-C31coPhk.js";import{c as ue,d as ge,e as pe,f as de,S as O,g as Se,h as ye,a as fe,b as H,L as he,R as Ne,F as be}from"./utils-D_fBc4qe.js";import{G as xe}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{S as ve,a as Ee,b as Re,c as Le,d as we,e as je}from"./win-Ct7LYCZq.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";function Ue(){const P=N.useGame(),I=K(),{mobile:S}=J(),D=q("slots"),y=S?"classic":"wide",c=ue(y),a=ge(y),o=pe(y);de(y);const[T,A]=r.useState(!1),[L,G]=r.useState(),[b,x]=r.useState(!1),[C,w]=r.useState(o),[m,W]=Q(),[f,U]=r.useState(Array.from({length:o}).map(()=>O[0])),[k,j]=r.useState([]),[F,v]=r.useState(null);r.useEffect(()=>{console.log("🎰 RESPONSIVE MODE CHANGE:",{isMobile:S,slotMode:y,NUM_REELS:c,NUM_ROWS:a,NUM_SLOTS:o,previousCombinationLength:f.length}),U(Array.from({length:o}).map(()=>O[0])),w(o),j([]),v(null),x(!1)},[o,S]);const{settings:M}=X();console.log("🎰 SLOTS DEBUG:",{isMobile:S,slotMode:S?"4×3":"6×3",NUM_REELS:c,NUM_ROWS:a,NUM_SLOTS:o,spinning:T,result:!!L,good:b,revealedSlots:C,wager:m,enableMotion:M.enableMotion,combination:f.map(n=>n.multiplier),winningPaylines:k.length,combinationLength:f.length});const d=Z({win:je,lose:we,reveal:Le,revealLegendary:Re,spin:Ee,play:ve}),u=r.useMemo(()=>(Math.min(I.maxPayout,m*Math.max(...ee.betArray)),Se()),[I.maxPayout,m]);r.useMemo(()=>Math.max(...u),[u]);const E=$.useRef(),i=r.useRef(null),B=m>0&&u.some(n=>n>0);$.useEffect(()=>()=>{E.current&&clearTimeout(E.current)},[]);const V=(n,s=0)=>{d.play("reveal",{playbackRate:1.1});const g=(s+1)*a;w(g);const h=n.slice(0,g).concat(Array.from({length:o-g}).map(()=>O[0])),p=H(h,c,a);for(let t=0;t<a;t++){const l=s*a+t;if(l<n.length&&n[l].multiplier>=he&&p.some(R=>R.payline.includes(l))){d.play("revealLegendary");break}}if(s<c-1)E.current=setTimeout(()=>V(n,s+1),Ne);else if(s===c-1){d.sounds.spin.player.stop();const t=H(n,c,a);j(t),E.current=setTimeout(()=>{if(A(!1),t.length>0?(x(!0),v(t[0].symbol),d.play("win"),console.log("🎰 SLOTS WIN! Triggering visual effects"),i.current?.winFlash(),i.current?.particleBurst(50,40),t.length>=3?(i.current?.screenShake(2,1e3),i.current?.particleBurst(25,60,void 0,10),i.current?.particleBurst(75,60,void 0,10)):t.length>=2?i.current?.screenShake(1.5,700):i.current?.screenShake(1,500)):(x(!1),v(null),d.play("lose"),console.log("💥 SLOTS LOSE! Triggering lose effects"),i.current?.loseFlash(),i.current?.screenShake(.5,300)),L){const l=L.payout>0;D.updateStats(l?L.payout:0)}},be)}},Y=async()=>{if(m<=0){console.error("❌ BLOCKED: Cannot play with zero wager");return}try{A(!0),G(void 0),console.log("🎰 Starting Slots game with:",{wager:m,bet:u.slice(0,10)+"...",betLength:u.length}),await P.play({wager:m,bet:[...u]}),d.play("play"),w(0),x(!1),j([]),v(null);const n=Date.now();d.play("spin",{playbackRate:.5}),console.log("🎰 Waiting for game result...");const s=await P.result();console.log("🎰 Game result received:",{payout:s.payout,multiplier:s.multiplier});const g=Date.now()-n,h=Math.max(0,ye-g),p=`${s.resultIndex}:${s.multiplier}:${s.payout}`,t=fe(o,s.multiplier,[...u],p,c,a);U(t),G(s),E.current=setTimeout(()=>V(t),h)}catch(n){console.error("🎰 SLOTS ERROR:",n),A(!1),G(void 0),w(o),x(!1),j([]),v(null);return}};return e.jsxs(e.Fragment,{children:[e.jsx(N.Portal,{target:"recentplays",children:e.jsx(xe,{gameId:"slots"})}),e.jsx(N.Portal,{target:"stats",children:e.jsx(le,{gameName:"Slots",gameMode:"Classic",rtp:"95",stats:D.stats,onReset:D.resetStats,isMobile:S})}),e.jsx(N.Portal,{target:"screen",children:e.jsxs(re,{children:[e.jsx("div",{className:"slots-bg-elements"}),e.jsx("div",{className:"casino-bg-elements"}),e.jsx("div",{className:"decorative-overlay"}),e.jsx(ie,{children:e.jsxs(se,{ref:i,..._("slots")&&{title:_("slots").name,description:_("slots").description},disableContainerTransforms:!0,children:[b&&e.jsx(te,{src:F?.image||f[0].image}),e.jsx(N.Responsive,{children:e.jsx("div",{className:"slots-content",children:e.jsxs("div",{className:"slots",children:[e.jsx("div",{className:"winning-line-display",children:e.jsx(ce,{betArray:[...u],winningMultiplier:F?.multiplier,isWinning:b})}),e.jsxs("div",{className:`slots-reels ${M.enableMotion?"motion-enabled":"motion-disabled"}`,children:[e.jsx("div",{className:`ecg-winning-line ${b?"active":""}`}),e.jsx("div",{className:"winning-line-arrow winning-line-arrow-left",children:e.jsx("div",{className:"arrow-icon",children:"▶"})}),Array.from({length:c}).map((n,s)=>{const g=Array.from({length:a}).map((t,l)=>{const R=s*a+l;return f[R]||O[0]}),h=Array.from({length:a}).map((t,l)=>{const R=s*a+l;return b&&k.some(z=>z.payline.includes(R))}),p=C>s*a;return console.log(`🎰 RENDERING REEL ${s}:`,{NUM_REELS:c,NUM_ROWS:a,NUM_SLOTS:o,slotMode:y,combinationLength:f.length,reelRevealed:p,isSpinning:T&&!p,enableMotion:M.enableMotion,reelItems:g.map(t=>t?.multiplier||"undefined"),reelGoodSlots:h,slotIndicesForThisReel:Array.from({length:a}).map((t,l)=>s*a+l)}),e.jsx(me,{reelIndex:s,revealed:p,good:h,items:g,isSpinning:T&&!p,enableMotion:M.enableMotion},s)}),e.jsx("div",{className:"winning-line-arrow winning-line-arrow-right",children:e.jsx("div",{className:"arrow-icon",children:"◀"})})]})]})})})]})})]})}),e.jsxs(N.Portal,{target:"controls",children:[e.jsx(ae,{wager:m,setWager:W,onPlay:Y,playDisabled:!B,playText:"Spin"}),e.jsx(ne,{onPlay:Y,playDisabled:!B,playText:"Spin",children:e.jsx(oe,{value:m,onChange:W})})]})]})}export{Ue as default};
