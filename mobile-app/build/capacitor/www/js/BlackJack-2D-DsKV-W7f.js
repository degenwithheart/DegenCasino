import{R as l,j as r}from"./three-DV31HySq.js";import{G as P,aH as ke,aI as Ce,aJ as xe,aK as Re,an as De,aL as Ae,bf as Fe,B as Ie,aM as je,aN as Pe,aO as Te,aV as we}from"./index-BarUt2o_.js";import{m as de}from"./deterministicRng-BQgZTO1k.js";import{G as We}from"./GameStatsHeader-DfbFCrGS.js";import{G as Be}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{G as ve}from"./GameControlsSection-BZ3LzTmM.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";const o=1200,f=800,d=100,u=200,Me="/sounds/win.mp3",Ee="/sounds/lose.mp3",Ge="/sounds/deal.mp3",Le="/sounds/play.mp3",He="/png/images/card.png",ue=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],ce=["♠","♥","♦","♣"],pe=["#000","#e53e3e","#e53e3e","#000"];function lt(){const E=P.useGame(),T=ke(),I=Ce(),[x,O]=xe(),{settings:Ne}=Re(),U=l.useRef(null),{mobile:p}=De(),R=Ae({win:Me,lose:Ee,deal:Ge,play:Le}),X=l.useRef(null),G=l.useRef(),[A,L]=l.useState("idle"),[h,K]=l.useState([]),[S,Y]=l.useState([]),[w,H]=l.useState(!1),[_e,$]=l.useState(0),[Ve,q]=l.useState(0),[ze,Q]=l.useState(0),[Je,Z]=l.useState(0),[Oe,N]=l.useState(!1),[ge,_]=l.useState(!1),[ee,te]=l.useState(!1),[me,V]=l.useState(null),[be,ae]=l.useState(null),[le,W]=l.useState([!1,!1]),[se,B]=l.useState([!1,!1]),[Ue,re]=l.useState(0),[k,he]=l.useState(null),z=Fe("blackjack-v2");l.useEffect(()=>{const e=new Image;e.onload=()=>he(e),e.src=He},[]);const y=Ie["blackjack-v2"],J=l.useMemo(()=>{const e=y.calculateBetArray();return Math.max(...e)},[y]);l.useMemo(()=>I.maxPayout/J,[I.maxPayout,J]);const oe=x*J>I.maxPayout,C=l.useCallback(e=>y.calculateHandValue(e),[y]),F=l.useCallback(e=>y.isBlackjack(e),[y]);l.useCallback(e=>y.isBust(e),[y]),l.useCallback(e=>{const s=de(e.toString()),t=[];for(let a=0;a<4;a++)t.push({rank:Math.floor(s()*13),suit:Math.floor(s()*4)});return{playerCards:[t[0],t[1]],dealerCards:[t[2],t[3]]}},[]);const Se=l.useCallback(async()=>{if(!T.isPlaying)try{N(!0),L("dealing"),_(!1),H(!1),V(null),R.play("play");const e=y.calculateBetArray();await E.play({bet:e,wager:x,metadata:["blackjack-v2"]});const s=await E.result();ae(s);const t=de(s.resultIndex.toString());let a=[],c=[],n=0;for(;n<100;){a=[{rank:Math.floor(t()*13),suit:Math.floor(t()*4)},{rank:Math.floor(t()*13),suit:Math.floor(t()*4)}],c=[{rank:Math.floor(t()*13),suit:Math.floor(t()*4)},{rank:Math.floor(t()*13),suit:Math.floor(t()*4)}];const g=C(a),D=C(c),m=F(a),M=F(c);let j=!1;if(s.resultIndex===0?j=M&&!m||D>g&&D<=21||g>21:s.resultIndex===1?j=m&&!M||g<=21&&(D>21||g>D):s.resultIndex===2?j=m&&!M:j=g===D||m&&M,j)break;n++}K(a),Y(c),W([!1,!1]),B([!1,!1]),re(0),setTimeout(()=>{R.play("deal"),B([!0,!1]),setTimeout(()=>{B([!0,!0]),setTimeout(()=>{W([!0,!1])},300)},300)},500);let i,b=!1;s.resultIndex===0?(i="Dealer Wins",b=!1):s.resultIndex===1?(i="Player Wins!",b=!0):s.resultIndex===2?(i="BlackJack!",b=!0):(i="Push",b=!1),setTimeout(()=>{H(!0),W([!0,!0]),V(i),L("game-over");const g=s.payout-x;$(m=>m+g),q(m=>m+1);const D=b;z.updateStats(D?1:0),b?(Q(m=>m+1),R.play("win"),U.current?.jackpot()):(Z(m=>m+1),R.play("lose")),_(!0),te(!0)},1500)}catch(e){console.error("Error playing BlackJack:",e)}finally{N(!1)}},[T,x,y,R,C,F,E]);l.useCallback(()=>{$(0),q(0),Q(0),Z(0),R.play("play")},[R]);const ye=l.useCallback(()=>{te(!1),N(!1),_(!1),ae(null),L("idle"),K([]),Y([]),H(!1),V(null),W([!1,!1]),B([!1,!1])},[]),ne=()=>A==="dealing"?"Dealing...":ee?"New":"Deal",ie=()=>ee?ye:Se,v=l.useCallback((e,s,t,a,c=!1,n=!0)=>{if(c&&!n)k?e.drawImage(k,t,a,d,u):(e.fillStyle="#000080",e.fillRect(t,a,d,u),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(t,a,d,u));else if(n){e.fillStyle="#ffffff",e.fillRect(t,a,d,u),e.strokeStyle="#000000",e.lineWidth=2,e.strokeRect(t,a,d,u);const i=s.suit===1||s.suit===2;e.fillStyle=i?pe[1]:pe[0],e.font="bold 16px Arial",e.textAlign="left",e.fillText(ue[s.rank],t+8,a+22),e.font="24px Arial",e.fillText(ce[s.suit],t+8,a+50),e.save(),e.translate(t+d-8,a+u-8),e.rotate(Math.PI),e.font="bold 12px Arial",e.fillText(ue[s.rank],0,14),e.font="16px Arial",e.fillText(ce[s.suit],0,32),e.restore()}else k?e.drawImage(k,t,a,d,u):(e.fillStyle="#000080",e.fillRect(t,a,d,u),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(t,a,d,u))},[k]),fe=l.useCallback(e=>{e.clearRect(0,0,o,f);const s=e.createRadialGradient(o/2,f/2,0,o/2,f/2,o/2);if(s.addColorStop(0,"#0f4c2c"),s.addColorStop(.6,"#0a3d23"),s.addColorStop(1,"#062818"),e.fillStyle=s,e.fillRect(0,0,o,f),e.fillStyle="rgba(15, 76, 44, 0.8)",e.fillRect(0,0,o,f),e.strokeStyle="#8B4513",e.lineWidth=8,e.strokeRect(4,4,o-8,f-8),e.beginPath(),e.arc(o/2,f-50,o/3,Math.PI,0),e.strokeStyle="#FFD700",e.lineWidth=3,e.stroke(),e.fillStyle="#FFD700",e.font="bold 24px serif",e.textAlign="center",e.fillText("BLACKJACK",o/2,50),e.font="16px serif",e.fillText("Dealer must hit soft 17",o/2,75),e.fillStyle="rgba(255, 215, 0, 0.1)",e.fillRect(50,100,o-100,160),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(50,100,o-100,160),e.fillStyle="#FFD700",e.font="bold 20px serif",e.textAlign="left",e.fillText("DEALER",70,125),w&&S.length>0){const t=C(S),a=t>21;e.fillStyle=a?"#ff4444":"#FFD700",e.font="bold 18px serif",e.textAlign="right",e.fillText(`${t}${a?" BUST":""}`,o-70,125)}else S.length>0&&(e.fillStyle="#FFD700",e.font="bold 18px serif",e.textAlign="right",e.fillText("?",o-70,125));if(S.length>0)S.forEach((t,a)=>{const i=o/2-S.length*80/2+a*80,b=140,g=le[a];!w&&a===1?v(e,t,i,b,!0,g):v(e,t,i,b,!1,g)});else for(let t=0;t<2;t++){const n=o/2-80+t*80,i=140;k?e.drawImage(k,n,i,d,u):(e.fillStyle="#000080",e.fillRect(n,i,d,u),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(n,i,d,u))}if(e.fillStyle="rgba(255, 215, 0, 0.1)",e.fillRect(50,f-200,o-100,160),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(50,f-200,o-100,160),e.fillStyle="#FFD700",e.font="bold 20px serif",e.textAlign="left",e.fillText("PLAYER",70,f-175),h.length>0){const t=C(h),a=t>21,c=F(h);e.fillStyle=a?"#ff4444":c?"#00ff00":"#FFD700",e.font="bold 18px serif",e.textAlign="right";let n=t.toString();a?n+=" BUST":c&&(n+=" BLACKJACK!"),e.fillText(n,o-70,f-175)}if(h.length>0)h.forEach((t,a)=>{const i=o/2-h.length*80/2+a*80,b=f-160,g=se[a];v(e,t,i,b,!1,g)});else for(let t=0;t<2;t++){const n=o/2-80+t*80,i=f-160;k?e.drawImage(k,n,i,d,u):(e.fillStyle="#000080",e.fillRect(n,i,d,u),e.strokeStyle="#FFD700",e.lineWidth=2,e.strokeRect(n,i,d,u))}A==="dealing"&&(e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,o,f),e.fillStyle="#FFD700",e.font="bold 36px serif",e.textAlign="center",e.fillText("Dealing Cards...",o/2,f/2),e.beginPath(),e.arc(o/2,f/2+50,20,0,2*Math.PI),e.strokeStyle="#FFD700",e.lineWidth=3,e.stroke())},[A,h,S,w,me,ge,C,v,F,be,x,le,se]);return l.useEffect(()=>{const e=X.current;if(!e)return;const s=e.getContext("2d");if(!s)return;let t=Date.now();const a=()=>{const n=Date.now()-t;re(n),fe(s),G.current=requestAnimationFrame(a)};return a(),()=>{G.current&&cancelAnimationFrame(G.current)}},[fe]),r.jsxs(r.Fragment,{children:[r.jsx(P.Portal,{target:"recentplays",children:r.jsx(Be,{gameId:"blackjack"})}),r.jsx(P.Portal,{target:"stats",children:r.jsx(We,{gameName:"BlackJack",gameMode:"V2",rtp:"95",stats:z.stats,onReset:z.resetStats,isMobile:p})}),r.jsx(P.Portal,{target:"screen",children:r.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"linear-gradient(135deg, #0a0511 0%, #0d0618 25%, #0f081c 50%, #0a0511 75%, #0a0511 100%)",perspective:"100px"},children:[r.jsx("canvas",{ref:X,width:o,height:f,style:{position:"absolute",top:"20px",left:"20px",right:"20px",bottom:"140px",width:"calc(100% - 40px)",height:"calc(100% - 160px)",imageRendering:"auto",borderRadius:"10px",border:"2px solid rgba(212, 165, 116, 0.4)",zIndex:0}}),r.jsxs(ve,{children:[r.jsxs("div",{style:{flex:p?"1":"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.25) 50%, rgba(76, 175, 80, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(76, 175, 80, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(76, 175, 80, 0.2), inset 0 1px 0 rgba(76, 175, 80, 0.3)",backdropFilter:"blur(8px)"},children:[r.jsx("div",{style:{fontSize:p?"11px":"14px",fontWeight:"bold",color:"#4caf50",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"PLAYER HAND"}),r.jsx("div",{style:{fontSize:p?"16px":"18px",color:"rgba(76, 175, 80, 0.9)",fontWeight:"600"},children:h.length>0?C(h):"-"})]}),r.jsxs("div",{style:{flex:p?"1":"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.15) 0%, rgba(245, 124, 0, 0.25) 50%, rgba(255, 152, 0, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(255, 152, 0, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(255, 152, 0, 0.2), inset 0 1px 0 rgba(255, 152, 0, 0.3)",backdropFilter:"blur(8px)"},children:[r.jsx("div",{style:{fontSize:p?"11px":"14px",fontWeight:"bold",color:"#ff9800",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"DEALER HAND"}),r.jsx("div",{style:{fontSize:p?"16px":"18px",color:"rgba(255, 152, 0, 0.9)",fontWeight:"600"},children:S.length>0?C(w?S:[S[0]]):"-"})]}),r.jsxs("div",{style:{flex:p?"1":"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(184, 51, 106, 0.15) 0%, rgba(136, 14, 79, 0.25) 50%, rgba(184, 51, 106, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(184, 51, 106, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(184, 51, 106, 0.2), inset 0 1px 0 rgba(184, 51, 106, 0.3)",backdropFilter:"blur(8px)"},children:[r.jsx("div",{style:{fontSize:p?"11px":"14px",fontWeight:"bold",color:"#b8336a",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"WIN CHANCE"}),r.jsx("div",{style:{fontSize:p?"16px":"18px",color:"rgba(184, 51, 106, 0.9)",fontWeight:"600"},children:A==="idle"?"-":"~50%"})]}),r.jsxs("div",{style:{flex:p?"1":"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(139, 90, 158, 0.15) 0%, rgba(106, 27, 154, 0.25) 50%, rgba(139, 90, 158, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(139, 90, 158, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(139, 90, 158, 0.2), inset 0 1px 0 rgba(139, 90, 158, 0.3)",backdropFilter:"blur(8px)"},children:[r.jsx("div",{style:{fontSize:p?"11px":"14px",fontWeight:"bold",color:"#8b5a9e",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"MULTIPLIER"}),r.jsx("div",{style:{fontSize:p?"16px":"18px",color:"rgba(139, 90, 158, 0.9)",fontWeight:"600"},children:F(h)?"2.50x":"1.95x"})]})]}),r.jsx(je,{ref:U,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3}})]})}),r.jsxs(P.Portal,{target:"controls",children:[r.jsx(Pe,{wager:x,setWager:O,onPlay:ie(),playDisabled:A==="dealing"||!I||T.isPlaying||oe,playText:ne()}),r.jsx(Te,{onPlay:ie(),playDisabled:A==="dealing"||!I||T.isPlaying||oe,playText:ne(),children:r.jsx(we,{value:x,onChange:O})})]})]})}export{lt as default};
