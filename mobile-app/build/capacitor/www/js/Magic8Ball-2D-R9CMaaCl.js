import{r,R as ne,j as A}from"./three-DV31HySq.js";import{aH as fe,aJ as pe,aI as be,bf as ye,an as Se,aK as Me,aL as Ce,B as Q,G as T,aM as Pe,aN as Ie,aO as Be,aV as we}from"./index-BarUt2o_.js";import{G as Te}from"./GameStatsHeader-DfbFCrGS.js";import{u as J}from"./useGameMeta-C4Hfe5lB.js";import{G as Re}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{G as Ee}from"./GameControlsSection-BZ3LzTmM.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";const ke="/assets/lose-Pg3x1oHK.mp3",Ne="data:audio/mpeg;base64,//uUZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAFoACioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi//////////////////////////////////////////////////////////////////8AAAA8TEFNRTMuMTAwBK8AAAAAAAAAADUgJALCjQABzAAABaBVoENUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//vEZAAAAZYTUh094AgAAA/woAABFNCvQ7ndgEAAAD/DAAAAA/wAA3ilMsavdn4LmXOMrHBTk7MtcCbjjVcB5VjZ7K9n3Aiahx8P35/cUDBc+H5zxBBAgAAAAAUCgPFi4MgAAAQhGYXhIYHB2YZAkqiYCDCZREgdBTgZFo6bLrSaVKKZTE+aaDOYZjARPYYVgIZpDiYNAUcXTHTBhg0qCvQxUvMukwaHGblgCUTHUQwpTMkC0RX/AgGgsw5ZBh5oQBKlpkAGnnPIUOUmI2kkSOdF2EJVZl8ovX8YEl7iUMPyB0mHTT/S6t////DcvgOL4Re/Psppq8ZPdAYKRZWLABAEDMaj6hQAgAAAAuyKhwCgEwYBjDAFAQ3HRoABAY/KBsiKmHC2YtJQCFBhURBiABAZMNgMwMEgMhC0AYPgYvZgFhkBhwggY2CIBSQDJwMJhYAgSgYRBYGERoA8JCPQsiAw6IQbDCZgY1AQAQcCyEOGRMLnRyzi1QDg2BgkDhloGxANkBCMgJAkDDogAiJQDgV+TpExzysThFAMCA0BwOBuaACCAFwODbL+eTMz6CjQRyISCgRSQrcUELT/uib0jSw5gyo+iDjLEqRAZX/059Bjybm5gRhJjLE2Sw5JMEkQIn//7Ghm5uYMaJpm6CBVICVCeIcVydIaWiLE0ViZ/////5otM3Uh////yiVSaMieJkSWWJsfh/CVyunN0L0TVCkSQUuJ0uMJPIcElEiVVVV6pJsFNBTcgrgV4KbFNyCuBTwUXFFZBTAU+KLxFExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uUZNEACJqCz25yoJAAAA/wwAAAB3Q/J3zzACgAAD/DgAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",De="/assets/play-lr1BXNxD.mp3",Ge="/assets/win-BSUZMT9R.mp3",b=800,y=600,R=200,O=2500,W=50;function Oe(){const N=fe(),[h,H]=pe(),G=be(),[L,v]=r.useState(-1),[d,j]=r.useState(!1),[re,U]=r.useState(null),K=ye("magic8ball"),[Le,se]=r.useState(0),[ve,oe]=r.useState(0),[je,ie]=r.useState(0),{mobile:le}=Se(),[n,S]=r.useState({currentNumber:0,targetNumber:0,isAnimating:!1,animationProgress:0,particles:[],randomSequence:[],currentSequenceIndex:0}),{settings:m}=Me(),E=m.quality!=="low",_=m.quality==="high"||m.quality==="ultra",X=m.quality!=="low",Y=m.quality==="ultra"?W:m.quality==="high"?Math.floor(W*.75):m.quality==="medium"?Math.floor(W*.5):0,B=m.enableEffects,u=m.enableMotion,k=r.useRef(null),g=r.useRef(),w=r.useRef(0),F=Ce({win:Ge,play:De,lose:ke,tick:Ne}),D=Q.magic8ball.getMultiplier();ne.useMemo(()=>Q.magic8ball.calculateBetArray(),[]);const ue=D*h;ne.useMemo(()=>G.maxPayout/D,[G.maxPayout,D]);const $=ue>G.maxPayout,z=T.useGame();r.useEffect(()=>{S(e=>({...e,currentNumber:0,targetNumber:0,isAnimating:!1,animationProgress:0,particles:[],randomSequence:[],currentSequenceIndex:0}))},[]);const ee=r.useCallback(e=>{if(!u)return;w.current===0&&(w.current=e);const q=e-w.current,l=Math.min(q/O,1),c=80,a=20,f=Math.min(Math.floor(q/c),a-1);S(p=>{const o=B?p.particles.map(i=>({...i,x:i.x+i.vx,y:i.y+i.vy,life:i.life-1,vy:i.vy+.1})).filter(i=>i.life>0):[];return l>=1||f>=a-1?{...p,isAnimating:!1,animationProgress:1,particles:o,currentSequenceIndex:a-1}:(g.current=requestAnimationFrame(ee),{...p,animationProgress:l,particles:o,currentSequenceIndex:f})})},[O,u,B,E]),ce=r.useCallback(e=>{if(!u){S(a=>({...a,targetNumber:e,isAnimating:!1,animationProgress:1,particles:[],randomSequence:[e],currentSequenceIndex:0}));return}const q=[],l=20,c=typeof e=="string"?e:e===1?"Win":"Lose";for(let a=0;a<l-1;a++)q.push("Thinking...");q.push(c),S({currentNumber:0,targetNumber:e,isAnimating:!0,animationProgress:0,particles:[],randomSequence:q,currentSequenceIndex:0}),w.current=0,g.current=requestAnimationFrame(ee)},[u]),qe=r.useCallback((e,q,l)=>{if(!E||Y===0)return;const c=[];for(let a=0;a<Y;a++)c.push({x:e,y:q,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10-5,life:60+Math.random()*60,maxLife:120,color:l,size:2+Math.random()*4});S(a=>({...a,particles:[...a.particles,...c]}))},[E,Y]),ge=r.useCallback(({ctx:e,size:q},l)=>{e.clearRect(0,0,q.width,q.height);const a=performance.now()*.001,f=e.createRadialGradient(q.width/2,q.height/2,0,q.width/2,q.height/2,Math.max(q.width,q.height)/2);f.addColorStop(0,"#1a1a2e"),f.addColorStop(.5,"#16213e"),f.addColorStop(1,"#0f0f23"),e.fillStyle=f,e.fillRect(0,0,q.width,q.height),e.save(),e.globalAlpha=.15,e.fillStyle="rgba(212, 165, 116, 0.3)",e.font="120px serif",e.textAlign="center",e.save(),e.translate(q.width*.12,q.height*.15),e.rotate(-15*Math.PI/180),e.fillText("‚öÉ",0,0),e.restore(),e.fillStyle="rgba(184, 51, 106, 0.25)",e.font="100px serif",e.save(),e.translate(q.width*.88,q.height*.85),e.rotate(25*Math.PI/180),e.fillText("‚öÑ",0,0),e.restore(),e.fillStyle="rgba(139, 90, 158, 0.2)",e.font="60px serif",e.save(),e.translate(q.width*.75,q.height*.25),e.rotate(45*Math.PI/180),e.fillText("‚öÇ",0,0),e.restore(),e.save(),e.translate(q.width*.25,q.height*.75),e.rotate(-30*Math.PI/180),e.fillText("‚öÅ",0,0),e.restore(),e.fillStyle="rgba(212, 165, 116, 0.15)",e.font="40px serif";const p=["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"];for(let t=0;t<8;t++){const s=t*q.width/8+q.width/16,I=q.height*.3+Math.sin(t*.8)*60;e.save(),e.translate(s,I),e.rotate(t*45*Math.PI/180),e.fillText(p[t%p.length],0,0),e.restore()}e.restore();const o=q.width/b,Ae=q.height/y,i=Math.min(o,Ae),me=(q.width-b*i)/2,he=(q.height-y*i)/2;if(e.save(),e.translate(me,he),e.scale(i,i),X){e.strokeStyle="rgba(138, 43, 226, 0.3)",e.lineWidth=2;for(let t=0;t<8;t++){const s=u?(a*1+t*Math.PI/4)%(Math.PI*2):t*Math.PI/4,I=u?150+Math.sin(a*2+t)*50:150,Z=b/2+Math.cos(s)*I,V=y/2+Math.sin(s)*I;e.beginPath(),e.arc(Z,V,30+t*10,0,Math.PI*2),e.stroke()}}if(_){e.fillStyle="rgba(255, 215, 0, 0.6)",e.font="24px serif",e.textAlign="center";const t=["‚ú¶","‚úß","‚ú©","‚ú™","‚ú´","‚ú¨","‚ú≠","‚úÆ","‚úØ","‚ú∞"];for(let s=0;s<10;s++){const I=s*Math.PI/5,Z=u?Math.sin(a*.1+s)*200+b/2:Math.cos(I)*200+b/2,V=u?Math.cos(a*.1+s)*150+y/2:Math.sin(I)*150+y/2;e.save(),e.translate(Z,V);const de=u?a*1.5+s:s*.5;e.rotate(de),e.fillText(t[s%t.length],0,0),e.restore()}}E&&B&&n.particles.forEach(t=>{const s=t.life/t.maxLife;e.save(),e.globalAlpha=s,e.fillStyle=t.color,e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill(),e.restore()});const M=b/2,C=y/2,x=e.createRadialGradient(M,C,0,M,C,R/2+20);x.addColorStop(0,"rgba(212, 165, 116, 0.8)"),x.addColorStop(1,"rgba(212, 165, 116, 0)"),e.fillStyle=x,e.beginPath(),e.arc(M,C,R/2+20,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(M,C,R/2,0,Math.PI*2),e.fill(),e.strokeStyle="#d4a574",e.lineWidth=4,e.beginPath(),e.arc(M,C,R/2,0,Math.PI*2),e.stroke(),e.strokeStyle="rgba(139, 90, 158, 0.6)",e.lineWidth=2,e.beginPath(),e.arc(M,C,R/2-10,0,Math.PI*2),e.stroke();let P="-";n.isAnimating?n.randomSequence.length>0&&n.currentSequenceIndex<n.randomSequence.length?P=n.randomSequence[n.currentSequenceIndex].toString():n.targetNumber!==0&&n.targetNumber!==""?P=n.targetNumber.toString():P="Thinking...":n.targetNumber!==0&&n.targetNumber!==""?P=n.targetNumber.toString():d&&L>=0?P=L===1?"Win":"Lose":N.isPlaying&&(P="Thinking..."),e.fillStyle="#d4a574",e.font=`bold ${R*.25}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(P,M,C),e.restore()},[n,d,N.isPlaying,re,L,E,_,X,B,u]),te=async()=>{if(h<=0){console.error("‚ùå BLOCKED: Cannot play with zero wager");return}j(!1),v(-1),U(null),S(o=>({...o,currentNumber:0,targetNumber:0,isAnimating:!1,animationProgress:0,particles:[],randomSequence:[],currentSequenceIndex:0})),w.current=0,g.current&&(cancelAnimationFrame(g.current),g.current=void 0),F.play("play");const e=Q.magic8ball.calculateBetArray();console.log("ÔøΩ MAGIC 8-BALL BET ARRAY DEBUG:",{betArray:e,nonZeroCount:e.filter(o=>o>0).length,maxBet:Math.max(...e),wager:h}),await z.play({wager:h,bet:e});const q=await z.result(),l=q.payout>0;U(l?"win":"lose");const c=Math.floor(Math.random()*100)+1;console.log("ÔøΩ MAGIC 8-BALL RESULT:",{resultIndex:q.resultIndex,payout:q.payout,multiplier:q.multiplier,luckyNumber:c,win:l}),v(c);const a=q.payout-h;K.updateStats(a),setTimeout(()=>ce(l?"Win":"Lose"),u?50:0);const p=u?O+100:100;setTimeout(()=>{j(!0),oe(o=>o+1),se(o=>o+(q.payout-h)),l&&ie(o=>o+1),console.log("üé≤ ANIMATION COMPLETE - Final result:",c),l?(F.play("win"),B&&(k.current?.winFlash("#00ff00",1.5),qe(b/2,y/2,"#ffd700"),k.current?.screenShake(1,600))):(F.play("lose"),B&&(k.current?.loseFlash("#ff4444",.8),qe(b/2,y/2,"#ff6b6b"),k.current?.screenShake(.5,400)))},p)},ae=()=>{j(!1),v(-1),U(null),S(e=>({...e,currentNumber:0,targetNumber:0,isAnimating:!1,animationProgress:0,particles:[],randomSequence:[],currentSequenceIndex:0})),w.current=0,g.current&&(cancelAnimationFrame(g.current),g.current=void 0)};return r.useEffect(()=>()=>{g.current&&cancelAnimationFrame(g.current)},[]),A.jsxs(A.Fragment,{children:[A.jsx(T.Portal,{target:"recentplays",children:A.jsx(Re,{gameId:"magic8ball"})}),A.jsx(T.Portal,{target:"stats",children:A.jsx(Te,{gameName:"Magic 8-Ball",gameMode:"2D",rtp:"95",stats:K.stats,onReset:K.resetStats,isMobile:le})}),A.jsx(T.Portal,{target:"screen",children:A.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"linear-gradient(135deg, #0a0511 0%, #0d0618 25%, #0f081c 50%, #0a0511 75%, #0a0511 100%)",perspective:"100px"},children:[A.jsx("div",{style:{position:"absolute",top:"20px",left:"20px",right:"20px",bottom:"120px",borderRadius:"10px",overflow:"hidden",border:"2px solid rgba(212, 165, 116, 0.4)"},children:A.jsx(T.Canvas,{style:{width:"100%",height:"100%"},render:ge})}),A.jsx(Ee,{children:A.jsxs("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(10, 5, 17, 0.9) 0%, rgba(139, 90, 158, 0.1) 50%, rgba(10, 5, 17, 0.9) 100%)",borderRadius:"12px",border:"2px solid rgba(212, 165, 116, 0.5)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"8px 16px",boxShadow:"0 4px 16px rgba(10, 5, 17, 0.4), inset 0 1px 0 rgba(212, 165, 116, 0.2)",backdropFilter:"blur(10px)",position:"relative"},children:[A.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#d4a574",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"MAGIC 8-BALL"}),A.jsxs("div",{style:{fontSize:"12px",color:"rgba(212, 165, 116, 0.9)",fontWeight:"600",textAlign:"center"},children:["50/50 Chance ‚Ä¢ ",D,"x Multiplier"]})]})}),A.jsx(Pe,{ref:k,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3},...J("magic8ball")&&{title:J("magic8ball").name,description:J("magic8ball").description}})]})}),A.jsxs(T.Portal,{target:"controls",children:[A.jsx(Ie,{wager:h,setWager:H,onPlay:d?ae:te,playDisabled:N.isPlaying||!d&&n.isAnimating||$,playText:d?"Ask Again":"Ask the Magic 8-Ball"}),A.jsx(Be,{onPlay:d?ae:te,playDisabled:N.isPlaying||!d&&n.isAnimating||$,playText:d?"Ask Again":"Ask the Magic 8-Ball",children:A.jsx(we,{value:h,onChange:H})})]})]})}export{Oe as default};
