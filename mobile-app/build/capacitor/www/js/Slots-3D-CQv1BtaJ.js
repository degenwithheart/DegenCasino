import{R as i,r as Z,j as e}from"./three-DV31HySq.js";import{G as N,aI as le,t as re,an as ie,bf as ce,aJ as ue,aK as me,aL as ge,aF as pe,aM as Se,bo as Ee,aN as Me,aO as de,aV as fe}from"./index-BarUt2o_.js";import{G as Re}from"./GameStatsHeader-DfbFCrGS.js";import{u as $}from"./useGameMeta-C4Hfe5lB.js";import{S as he,a as Le,I as ye,R as Ne}from"./SlotsBackground.enhanced.styles-C31coPhk.js";import{c as Ae,d as Oe,e as Ce,f as xe,S as G,h as be,a as Ie,b as ee,L as Te,R as Pe,F as De}from"./utils-D_fBc4qe.js";import{S as ve,a as Ge,b as we,c as We,d as Ye,e as je}from"./win-Ct7LYCZq.js";import{G as _e}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";function Qe(){const F=N.useGame(),w=le(),c=re(),{mobile:h}=ie(),W=ce("slots"),se=i.useMemo(()=>{if(!c?.baseWager)return 0;const s=Math.floor(.0043*c.baseWager);return console.log("🎰 SLOTS TESTING - Custom Min Wager:",s,"lamports =",s/c.baseWager,"SOL"),s},[c?.baseWager]),te=i.useMemo(()=>{if(!c?.baseWager)return 1/0;const s=Math.floor(3*c.baseWager);return console.log("🎰 SLOTS TESTING - Custom Max Wager:",s,"lamports =",s/c.baseWager,"SOL"),s},[c?.baseWager]),L=h?"classic":"wide",M=Ae(L),n=Oe(L),m=Ce(L);xe(L);const[Y,j]=i.useState(!1),[I,_]=i.useState(),[A,O]=i.useState(!1),[k,T]=i.useState(m),[g,U]=ue(),[y,B]=i.useState(Array.from({length:m}).map(()=>G[0])),[V,P]=i.useState([]),[z,C]=i.useState(null);i.useEffect(()=>{console.log("🎰 RESPONSIVE MODE CHANGE:",{isMobile:h,slotMode:L,NUM_REELS:M,NUM_ROWS:n,NUM_SLOTS:m,previousCombinationLength:y.length}),B(Array.from({length:m}).map(()=>G[0])),T(m),P([]),C(null),O(!1)},[m,h]);const{settings:D}=me();console.log("🎰 SLOTS DEBUG:",{isMobile:h,slotMode:h?"4×3":"6×3",NUM_REELS:M,NUM_ROWS:n,NUM_SLOTS:m,spinning:Y,result:!!I,good:A,revealedSlots:k,wager:g,enableMotion:D.enableMotion,combination:y.map(s=>s.multiplier),winningPaylines:V.length,combinationLength:y.length});const R=ge({win:je,lose:Ye,reveal:We,revealLegendary:we,spin:Ge,play:ve}),d=i.useMemo(()=>{if(!w?.maxPayout||!g||!c?.baseWager)return pe.betArray;const s=g/c.baseWager,t=w.maxPayout/c.baseWager,u=Math.floor(t/s*100)/100,f=.925,p=.425,o=1e3,r=Math.floor(o*p),l={MYTHICAL:1,LEGENDARY:2,EPIC:5,RARE:12,COMMON:r-20},H=f*o/r,E={MYTHICAL:1,LEGENDARY:.6,EPIC:.3,RARE:.15,COMMON:.05},ae=E.MYTHICAL*l.MYTHICAL+E.LEGENDARY*l.LEGENDARY+E.EPIC*l.EPIC+E.RARE*l.RARE+E.COMMON*l.COMMON,b=H/(ae/r);let a={MYTHICAL:Math.floor(b*E.MYTHICAL*100)/100,LEGENDARY:Math.floor(b*E.LEGENDARY*100)/100,EPIC:Math.floor(b*E.EPIC*100)/100,RARE:Math.floor(b*E.RARE*100)/100,COMMON:Math.floor(b*E.COMMON*100)/100};if(a.MYTHICAL>u){const v=u/a.MYTHICAL;a={MYTHICAL:u,LEGENDARY:Math.floor(a.LEGENDARY*v*100)/100,EPIC:Math.floor(a.EPIC*v*100)/100,RARE:Math.floor(a.RARE*v*100)/100,COMMON:Math.floor(a.COMMON*v*100)/100}}const oe=(a.MYTHICAL*l.MYTHICAL+a.LEGENDARY*l.LEGENDARY+a.EPIC*l.EPIC+a.RARE*l.RARE+a.COMMON*l.COMMON)/o,Q=[a.MYTHICAL,a.LEGENDARY,a.LEGENDARY,...Array(5).fill(a.EPIC),...Array(12).fill(a.RARE),...Array(405).fill(a.COMMON),...Array(575).fill(0)],X=s*Math.max(...Q),ne=X<=t;return console.log("🎰 DYNAMIC SLOTS - Wager:",s,"SOL"),console.log("🎰 Multipliers:",`${a.MYTHICAL}x / ${a.LEGENDARY}x / ${a.EPIC}x / ${a.RARE}x / ${a.COMMON}x`),console.log("🎰 Actual RTP:",`${(oe*100).toFixed(1)}%`,"Win Rate:",`${(p*100).toFixed(1)}%`),console.log("🎰 Max Payout Check:",`${X.toFixed(4)} SOL <= ${t.toFixed(4)} SOL`,ne?"✅":"❌"),Q},[w?.maxPayout,g,c?.baseWager]);i.useMemo(()=>Math.max(...d),[d]);const x=Z.useRef(),S=i.useRef(null),K=g>=se&&g<=te&&d.some(s=>s>0);Z.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]);const q=(s,t=0)=>{R.play("reveal",{playbackRate:1.1});const u=(t+1)*n;T(u);const f=s.slice(0,u).concat(Array.from({length:m-u}).map(()=>G[0])),p=ee(f,M,n);for(let o=0;o<n;o++){const r=t*n+o;if(r<s.length&&s[r].multiplier>=Te&&p.some(l=>l.payline.includes(r))){R.play("revealLegendary");break}}if(t<M-1)x.current=setTimeout(()=>q(s,t+1),Pe);else if(t===M-1){R.sounds.spin.player.stop();const o=ee(s,M,n);P(o),x.current=setTimeout(()=>{if(j(!1),o.length>0?(O(!0),C(o[0].symbol),R.play("win"),console.log("🎰 SLOTS WIN! Triggering visual effects"),S.current?.winFlash(),S.current?.particleBurst(50,40),o.length>=3?(S.current?.screenShake(2,1e3),S.current?.particleBurst(25,60,void 0,10),S.current?.particleBurst(75,60,void 0,10)):o.length>=2?S.current?.screenShake(1.5,700):S.current?.screenShake(1,500)):(O(!1),C(null),R.play("lose"),console.log("💥 SLOTS LOSE! Triggering lose effects"),S.current?.loseFlash(),S.current?.screenShake(.5,300)),I){const r=I.payout>0;W.updateStats(r?I.payout:0)}},De)}},J=async()=>{if(g<=0){console.error("❌ BLOCKED: Cannot play with zero wager");return}try{j(!0),_(void 0),console.log("🎰 Starting Slots game with:",{wager:g,bet:d.slice(0,10)+"...",betLength:d.length}),await F.play({wager:g,bet:[...d]}),R.play("play"),T(0),O(!1),P([]),C(null);const s=Date.now();R.play("spin",{playbackRate:.5}),console.log("🎰 Waiting for game result...");const t=await F.result();console.log("🎰 Game result received:",{payout:t.payout,multiplier:t.multiplier});const u=Date.now()-s,f=Math.max(0,be-u),p=`${t.resultIndex}:${t.multiplier}:${t.payout}`,o=Ie(m,t.multiplier,[...d],p,M,n);B(o),_(t),x.current=setTimeout(()=>q(o),f)}catch(s){console.error("🎰 SLOTS ERROR:",s),j(!1),_(void 0),T(m),O(!1),P([]),C(null);return}};return e.jsxs(e.Fragment,{children:[e.jsx(N.Portal,{target:"recentplays",children:e.jsx(_e,{gameId:"slots"})}),e.jsx(N.Portal,{target:"stats",children:e.jsx(Re,{gameName:"Slots",gameMode:"Classic",rtp:"95",stats:W.stats,onReset:W.resetStats,isMobile:h})}),e.jsx(N.Portal,{target:"screen",children:e.jsxs(he,{children:[e.jsx("div",{className:"slots-bg-elements"}),e.jsx("div",{className:"casino-bg-elements"}),e.jsx("div",{className:"decorative-overlay"}),e.jsx(Le,{children:e.jsxs(Se,{ref:S,...$("slots")&&{title:$("slots").name,description:$("slots").description},disableContainerTransforms:!0,children:[A&&e.jsx(Ee,{src:z?.image||y[0].image}),e.jsx(N.Responsive,{children:e.jsx("div",{className:"slots-content",children:e.jsxs("div",{className:"slots",children:[e.jsx("div",{className:"winning-line-display",children:e.jsx(ye,{betArray:[...d],winningMultiplier:z?.multiplier,isWinning:A})}),e.jsxs("div",{className:`slots-reels ${D.enableMotion?"motion-enabled":"motion-disabled"}`,children:[e.jsx("div",{className:`ecg-winning-line ${A?"active":""}`}),e.jsx("div",{className:"winning-line-arrow winning-line-arrow-left",children:e.jsx("div",{className:"arrow-icon",children:"▶"})}),Array.from({length:M}).map((s,t)=>{const u=Array.from({length:n}).map((o,r)=>{const l=t*n+r;return y[l]||G[0]}),f=Array.from({length:n}).map((o,r)=>{const l=t*n+r;return A&&V.some(H=>H.payline.includes(l))}),p=k>t*n;return console.log(`🎰 RENDERING REEL ${t}:`,{NUM_REELS:M,NUM_ROWS:n,NUM_SLOTS:m,slotMode:L,combinationLength:y.length,reelRevealed:p,isSpinning:Y&&!p,enableMotion:D.enableMotion,reelItems:u.map(o=>o?.multiplier||"undefined"),reelGoodSlots:f,slotIndicesForThisReel:Array.from({length:n}).map((o,r)=>t*n+r)}),e.jsx(Ne,{reelIndex:t,revealed:p,good:f,items:u,isSpinning:Y&&!p,enableMotion:D.enableMotion},t)}),e.jsx("div",{className:"winning-line-arrow winning-line-arrow-right",children:e.jsx("div",{className:"arrow-icon",children:"◀"})})]})]})})})]})})]})}),e.jsxs(N.Portal,{target:"controls",children:[e.jsx(Me,{wager:g,setWager:U,onPlay:J,playDisabled:!K,playText:"Spin"}),e.jsx(de,{onPlay:J,playDisabled:!K,playText:"Spin",children:e.jsx(fe,{value:g,onChange:U})})]})]})}export{Qe as default};
