import{R as g,j as t}from"./three-DV31HySq.js";import{G as W,aH as we,aI as Ge,aL as ke,an as Re,bf as We,aJ as Pe,aK as Ae,B as re,aM as Te,aN as ie,aO as oe,aV as Ee,aP as de}from"./index-BarUt2o_.js";import{u as Ie}from"./useGameMeta-C4Hfe5lB.js";import{G as De}from"./GameStatsHeader-DfbFCrGS.js";import{S as Fe,a as ze,b as Le,c as Ne,d as $e,g as U,G as y,M as ce,r as Be,e as Oe}from"./utils-DfVwoEZU.js";import{G as Xe}from"./GameRecentPlaysHorizontal-CmiF3H-Z.js";import{G as _e}from"./GameControlsSection-BZ3LzTmM.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-Bm3pLP40.js";import"./deterministicRng-BQgZTO1k.js";const j=5;function nt(){const V=W.useGame(),fe=we(),E=Ge(),G=ke({reveal:$e,mine:Ne,win:Le,step:ze,finish:Fe}),{mobile:$}=Re(),I=We("mines"),[m,B]=Pe(),[d,K]=g.useState(3),[k,D]=g.useState(U(y)),[F,z]=g.useState("waiting"),[C,O]=g.useState(0),[v,X]=g.useState(0),[p,_]=g.useState(!1),[P,L]=g.useState(!1),A=g.useRef(null),{settings:ge}=Ae();ge.enableMotion;const u=g.useMemo(()=>{const e=y-d;let a=m;return Array.from({length:e}).map((l,n)=>{const s=n===0?m:a,c=re.mines,f=c.getMultiplier(d,n+1),r=c.calculateBetArray(d,n),i=s*(f-1),o=s+i;return a=o,{bet:r,wager:s,profit:i,balance:o,multiplier:f}})},[m,d]),J=g.useMemo(()=>re.mines.getMultiplier(d,y-d),[d]);g.useMemo(()=>E.maxPayout/J,[E.maxPayout,J]);const Z=g.useMemo(()=>{const e=u.length>0?Math.max(...u.map(a=>a.multiplier)):1;return m*e>E.maxPayout},[m,u,E.maxPayout]),pe=y-C<=d,ue=p&&!P&&!pe,q=u[C],Q=()=>q?.multiplier||1,ee=()=>u[C+1]?.multiplier||1,te=async()=>{D(U(y)),z("playing"),O(0),X(0),_(!0),L(!1),G.play("step")},H=async()=>{G.play("finish"),me()},me=()=>{D(U(y)),z("waiting"),O(0),X(0),_(!1),L(!1)},ae=async e=>{if(ue&&k[e].status==="hidden"&&!fe.isPlaying){L(!0);try{G.play("step");const{bet:a,wager:l}=q;await V.play({bet:a,wager:l,metadata:[d,C,e]});const n=await V.result();if(n.multiplier===0){_(!1),z("lost");const s=Be(k,e,d);D(s),G.play("mine"),I.updateStats(0),A.current&&A.current.loseFlash("#ff4444",2)}else{const s=C+1;O(s);const c=Oe(k,e,n.profit);D(c),X(n.payout),G.play("reveal"),s>=u.length&&(G.play("win"),z("won"),I.updateStats(n.payout),A.current&&A.current.winFlash("#4caf50",3))}}catch(a){console.error("Cell reveal failed:",a)}finally{L(!1)}}},be=g.useCallback(({ctx:e,size:a})=>{e.clearRect(0,0,a.width,a.height),e.fillStyle="#1a1a2e",e.fillRect(0,0,a.width,a.height),he(e,a)},[F,d,m,k,C,p,u,Q,ee,v]),he=(e,a)=>{const l=a?.width||e.canvas.width,n=a?.height||e.canvas.height,s=20,c=l-s*2,f=n-s*2,r=Math.min(c,f),i=(l-r)/2,o=(n-r)/2;e.fillStyle="rgba(26, 26, 46, 0.8)",e.fillRect(i-10,o-10,r+20,r+20);const b=8,h=(r-b*(j-1))/j;for(let x=0;x<y;x++){const S=Math.floor(x/j),M=x%j,w=i+M*(h+b),ne=o+S*(h+b);xe(e,w,ne,h,k[x])}ve(e,l,n,$?80:120)},xe=(e,a,l,n,s,c)=>{const r=a+2,i=l+2,o=n-4;switch(s.status){case"hidden":e.fillStyle="#333366";break;case"gold":e.fillStyle="#4caf50";break;case"mine":e.fillStyle="#f44336";break}e.fillRect(r,i,o,o),e.strokeStyle="rgba(147, 88, 255, 0.3)",e.lineWidth=1,e.strokeRect(r,i,o,o),s.status==="mine"?(e.fillStyle="#ffffff",e.font=`${o*.6}px monospace`,e.textAlign="center",e.fillText("ðŸ’£",r+o/2,i+o*.7)):s.status==="gold"&&(e.fillStyle="#ffffff",e.font=`${o*.6}px monospace`,e.textAlign="center",e.fillText("ðŸ’Ž",r+o/2,i+o*.7))},Se=(e,a,l,n,s,c)=>{const f=Math.min(12,n*.1);e.fillStyle="rgba(34, 197, 94, 0.9)",e.beginPath(),e.roundRect(a,l,n,s,f),e.fill(),e.strokeStyle="rgba(74, 222, 128, 0.6)",e.lineWidth=2,e.beginPath(),e.roundRect(a+1,l+1,n-2,s-2,f-1),e.stroke();const r=Math.min(20,s*.12);e.fillStyle="#ffffff",e.font=`${r}px Arial`,e.textAlign="center",e.fillText("ðŸ’Ž",a+n-r*.7,l+r+8);const i=Math.min(14,s*.1);e.fillStyle="#ffffff",e.font=`bold ${i}px Arial`,e.fillText("GEMS LEFT",a+n/2,l+i+12);const o=Math.min(32,s*.3);e.fillStyle="#ffffff",e.font=`bold ${o}px Arial`,e.fillText(c.toString(),a+n/2,l+s*.55)},ye=(e,a,l,n,s,c)=>{const f=Math.min(12,n*.1);e.fillStyle="rgba(239, 68, 68, 0.9)",e.beginPath(),e.roundRect(a,l,n,s,f),e.fill(),e.strokeStyle="rgba(252, 165, 165, 0.6)",e.lineWidth=2,e.beginPath(),e.roundRect(a+1,l+1,n-2,s-2,f-1),e.stroke();const r=Math.min(18,s*.11);e.fillStyle="#ffffff",e.font=`${r}px Arial`,e.textAlign="center",e.fillText("ðŸ’£",a+n-r*.7,l+r+8);const i=Math.min(14,s*.1);e.fillStyle="#ffffff",e.font=`bold ${i}px Arial`,e.fillText("MINES",a+n/2,l+i+12);const o=Math.min(32,s*.3);e.fillStyle="#ffffff",e.font=`bold ${o}px Arial`,e.fillText(c.toString(),a+n/2,l+s*.55)},ve=(e,a,l,n)=>{const c=$?0:50,f=a-40,r=l-40,i=Math.min(f,r),b=(a-i)/2+i+c,h=(l-i)/2,R=(i-12)/2,x=12,S=k.filter(w=>w.status==="gold").length,M=y-d-S;Se(e,b,h,n,R,M),ye(e,b,h+R+x,n,R,d)},je=g.useCallback(e=>{const a=e.currentTarget;if(!a)return;const l=a.getBoundingClientRect(),n=e.clientX-l.left,s=e.clientY-l.top,c=a.width/l.width,f=a.height/l.height,r=n*c,i=s*f;if(p&&F==="playing"){const b=a.width,h=a.height,R=b-40,x=h-40,S=Math.min(R,x-100),M=(b-S)/2,w=(h-S)/2;if(r>=M&&r<M+S&&i>=w&&i<w+S){const N=(S-8*(j-1))/j;let Y=-1;for(let T=0;T<y;T++){const Ce=Math.floor(T/j),Me=T%j,se=M+Me*(N+8),le=w+Ce*(N+8);if(r>=se&&r<se+N&&i>=le&&i<le+N){Y=T;break}}Y>=0&&ae(Y)}}},[p,F,ae]);return Ie("mines"),t.jsxs(t.Fragment,{children:[t.jsx(W.Portal,{target:"recentplays",children:t.jsx(Xe,{gameId:"mines"})}),t.jsx(W.Portal,{target:"stats",children:t.jsx(De,{gameName:"Mines",gameMode:"V2",rtp:"95",stats:I.stats,onReset:I.resetStats,isMobile:$})}),t.jsx(W.Portal,{target:"screen",children:t.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"linear-gradient(135deg, #0a0511 0%, #0d0618 25%, #0f081c 50%, #0a0511 75%, #0a0511 100%)",perspective:"100px"},children:[t.jsx("div",{style:{position:"absolute",top:"20px",left:"20px",right:"20px",bottom:"120px",borderRadius:"10px",overflow:"hidden",border:"2px solid rgba(147, 88, 255, 0.4)"},children:t.jsx(W.Canvas,{style:{width:"100%",height:"100%",cursor:p&&F==="playing"&&!P?"pointer":"default"},render:be,onMouseDown:je})}),t.jsxs(_e,{children:[t.jsxs("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(147, 88, 255, 0.15) 0%, rgba(106, 27, 154, 0.25) 50%, rgba(147, 88, 255, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(147, 88, 255, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(147, 88, 255, 0.2), inset 0 1px 0 rgba(147, 88, 255, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#9358ff",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"LEVELS"}),t.jsx("div",{style:{fontSize:"16px",color:"rgba(147, 88, 255, 0.9)",fontWeight:"600"},children:p?`${C+1}/${u.length}`:`1/${u.length}`})]}),t.jsxs("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.25) 50%, rgba(76, 175, 80, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(76, 175, 80, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(76, 175, 80, 0.2), inset 0 1px 0 rgba(76, 175, 80, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#4caf50",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"BASE x"}),t.jsx("div",{style:{fontSize:"16px",color:"rgba(76, 175, 80, 0.9)",fontWeight:"600"},children:p?`${Q().toFixed(2)}x`:`${u[0]?.multiplier.toFixed(2)||"1.00"}x`})]}),t.jsxs("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(255, 235, 59, 0.15) 0%, rgba(251, 192, 45, 0.25) 50%, rgba(255, 235, 59, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(255, 235, 59, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(255, 235, 59, 0.2), inset 0 1px 0 rgba(255, 235, 59, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#ffeb3b",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"NEXT x"}),t.jsx("div",{style:{fontSize:"16px",color:"rgba(255, 235, 59, 0.9)",fontWeight:"600"},children:p?`${ee().toFixed(2)}x`:u[1]?`${u[1].multiplier.toFixed(2)}x`:"Start"})]}),t.jsxs("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.25) 50%, rgba(76, 175, 80, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(76, 175, 80, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(76, 175, 80, 0.2), inset 0 1px 0 rgba(76, 175, 80, 0.3)",backdropFilter:"blur(8px)"},children:[t.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#4caf50",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"TOTAL WON"}),t.jsx("div",{style:{fontSize:"16px",color:"rgba(76, 175, 80, 0.9)",fontWeight:"600"},children:p?v.toFixed(4):"0.0000"})]})]}),t.jsx(Te,{ref:A,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3}})]})}),t.jsx(W.Portal,{target:"controls",children:p?t.jsxs(t.Fragment,{children:[t.jsx(ie,{wager:m,setWager:B,onPlay:H,playDisabled:P||v===0,playText:v>0?"Cash":"New",children:p&&v>0&&t.jsx("div",{style:{marginTop:"10px"},children:t.jsx(de,{onClick:H,disabled:P||v===0,variant:"primary",children:"ðŸ’° Cash Out"})})}),t.jsx(oe,{children:p&&v>0&&t.jsx(de,{onClick:H,disabled:P||v===0,variant:"primary",children:"ðŸ’° Cash Out"})})]}):t.jsxs(t.Fragment,{children:[t.jsx(ie,{wager:m,setWager:B,onPlay:te,playDisabled:Z,playText:"Start",children:t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[t.jsx("label",{style:{color:"#fff",minWidth:"60px"},children:"Mines:"}),t.jsx("select",{value:d,onChange:e=>K(Number(e.target.value)),style:{padding:"8px",borderRadius:"4px",border:"1px solid rgba(147, 88, 255, 0.3)",background:"#1a1a2e",color:"#fff",flex:1},children:ce.map(e=>t.jsx("option",{value:e,children:e},e))})]})}),t.jsxs(oe,{onPlay:te,playDisabled:Z,playText:"Start",children:[t.jsx(Ee,{value:m,onChange:B}),t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx("label",{style:{color:"#fff",minWidth:"60px"},children:"Mines:"}),t.jsx("select",{value:d,onChange:e=>K(Number(e.target.value)),style:{padding:"8px",borderRadius:"4px",border:"1px solid rgba(147, 88, 255, 0.3)",background:"#1a1a2e",color:"#fff"},children:ce.map(e=>t.jsx("option",{value:e,children:e},e))})]})]})]})})]})}export{nt as default};
