import{R as p,j as a}from"./three-D4AtYCWe.js";import{G as H,av as ze,aP as Ee,aw as Fe,ay as Ge,W as ke,ax as De,az as Ne,aR as Le,aB as _e,aC as He,aD as Be}from"./index-eL7pTMGs.js";import{u as Oe}from"./useGameMeta-BoUQYdhj.js";import{G as Ue}from"./GameStatsHeader-BAMe0qyx.js";import{G as qe}from"./GameRecentPlaysHorizontal-DwRhmHlC.js";import{G as Ve}from"./GameControlsSection-vCoWFXil.js";import"./react-vendor-faCf7XlP.js";import"./blockchain-C0nfa7Sw.js";import"./physics-audio-DLMfKFaI.js";const q={flip:{calculateBetArray:(y,P,E)=>{const F=y+1,j=Array(F).fill(0),i=(l,I)=>{if(I<0||I>l)return 0;I=Math.min(I,l-I);let k=1;for(let c=0;c<I;c++)k=k*(l-c)/(c+1);return k},C=l=>i(y,l)*Math.pow(.5,y);let b=0;for(let l=P;l<=y;l++)b+=C(l);if(b===0)return j;const G=1/b*.96;if(E==="heads")for(let l=P;l<=y;l++)C(l),j[l]=G;else for(let l=0;l<=y-P;l++)C(l),j[l]=G;return j},probAtLeast:(y,P,E=.5)=>{const F=(i,C)=>{if(C<0||C>i)return 0;C=Math.min(C,i-C);let b=1;for(let R=0;R<C;R++)b=b*(i-R)/(R+1);return b};let j=0;for(let i=P;i<=y;i++)j+=F(y,i)*Math.pow(E,i)*Math.pow(1-E,y-i);return j},computeMultiplier:(y,P=.04)=>y<=0?0:(1-P)/y}},h=1200,m=800,Xe={background:"#1a0f2e"},V={MAX_COINS:8},Ye="/assets/coin-B4mEKXPK.mp3",Ke="/assets/win-BSUZMT9R.mp3",Ze="/assets/lose-Pg3x1oHK.mp3",$e="/assets/play-lr1BXNxD.mp3",Je="/assets/heads-BMVAyMSZ.webp",Qe="/assets/tails-CPdW6VDA.webp";function dt(){const y=H.useGame(),P=ze(),E=Ee(),[F,j]=Fe(),{settings:i}=Ge(),{mobile:C}=ke(),b=p.useRef(null),R=De({win:Ke,lose:Ze,coin:Ye,play:$e}),G=p.useRef(null),l=p.useRef(),[I,k]=p.useState("heads"),[c,Z]=p.useState(1),[W,$]=p.useState(1),[ce,J]=p.useState(0),[de,fe]=p.useState(0),[Q,pe]=p.useState(!1),[x,ee]=p.useState(!1),[te,ue]=p.useState(Array(V.MAX_COINS).fill(0)),[ae,ne]=p.useState({particles:[]}),B=Ne("flip-v2"),O=i.quality==="ultra"?50:i.quality==="high"?30:i.quality==="medium"?15:0,[X,ge]=p.useState(null),[Y,he]=p.useState(null),K=p.useCallback((e,f,d)=>{if(!i.enableEffects||O===0)return;const n=[];for(let g=0;g<O;g++)n.push({x:e,y:f,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10-5,life:60+Math.random()*60,maxLife:120,color:d,size:2+Math.random()*4});ne(g=>({...g,particles:[...g.particles,...n]}))},[i.enableEffects,O]);p.useEffect(()=>{if(!i.enableMotion)return;const f=setInterval(()=>{ne(d=>({...d,particles:d.particles.map(n=>({...n,x:n.x+n.vx,y:n.y+n.vy,life:n.life-1,vy:n.vy+.1})).filter(n=>n.life>0)}))},16);return()=>clearInterval(f)},[i.enableMotion]),p.useEffect(()=>{(async()=>{const f=new Image;f.src=Je,await new Promise(n=>{f.onload=n}),ge(f);const d=new Image;d.src=Qe,await new Promise(n=>{d.onload=n}),he(d)})()},[]);const[oe,se]=p.useState(Array(V.MAX_COINS).fill(null).map(()=>({rotation:0,scale:1,y:0,showing:"heads"})));p.useEffect(()=>{if(!x)return;(()=>{const d=performance.now(),n=g=>{const o=g-d,r=Math.min(o/2e3,1);se(S=>S.map((w,t)=>{if(t>=c)return w;const s=8+t%4*2,u=r*s*360,T=1+Math.sin(r*Math.PI*2)*.3,z=Math.sin(r*Math.PI*4)*30,A=u%360,v=A>90&&A<270?"tails":"heads";return{rotation:u,scale:T,y:z,showing:v}})),r<1?requestAnimationFrame(n):se(S=>S.map((w,t)=>t>=c?w:{...w,rotation:0,scale:1,y:0,showing:te[t]===1?"heads":"tails"}))};requestAnimationFrame(n)})()},[x,te,c]);const me=e=>{const n=m-140-160,g=h-120;if(X&&Y){const o=G.current;if(o){const r=o.getBoundingClientRect(),S=r.width/r.height,w=h/m;let t,s,u,T,z;const A=g-40,v=n-40;if(c<=4){s=Math.min(c,4),u=1;const M=Math.min(A/s*.8,v*.9);t=Math.min(500,M),T=(A-s*t)/Math.max(1,s-1),z=0}else if(c<=8){s=4,u=2;const M=Math.min(A/s*.85,v/u*.85);t=Math.min(500,M),T=(A-s*t)/(s-1),z=(v-u*t)/(u-1)}else if(c<=12){s=4,u=3;const M=Math.min(A/s*.9,v/u*.9);t=Math.min(500,M),T=(A-s*t)/(s-1),z=(v-u*t)/(u-1)}else if(c<=16){s=4,u=4;const M=Math.min(A/s*.95,v/u*.95);t=Math.min(500,M),T=(A-s*t)/(s-1),z=(v-u*t)/(s-1)}else{s=5,u=4;const M=Math.min(A/s*.95,v/u*.95);t=Math.min(500,M),T=(A-s*t)/(s-1),z=(v-u*t)/(u-1)}const Ie=s*t+(s-1)*T,we=u*t+(u-1)*z,Ae=60+(g-Ie)/2,Ce=140+(n-we)/2;for(let M=0;M<c;M++){const ve=M%s,Pe=Math.floor(M/s),je=Ae+ve*(t+T)+t/2,We=Ce+Pe*(t+z)+t/2,L=oe[M];e.save(),e.translate(je,We+L.y);const Re=w/S;e.scale(L.scale*Re,L.scale),e.rotate(L.rotation*Math.PI/180);const Te=L.showing==="heads"?X:Y,U=document.createElement("canvas");U.width=t,U.height=t;const _=U.getContext("2d");_.beginPath(),_.arc(t/2,t/2,t/2,0,Math.PI*2),_.closePath(),_.clip(),_.drawImage(Te,0,0,t,t),e.drawImage(U,-t/2,-t/2),e.restore()}}}e.restore()},be=()=>{const e=q.flip,f=e.probAtLeast(c,W);return e.computeMultiplier(f)},D=()=>q.flip.probAtLeast(c,W),xe=p.useMemo(()=>{const e=q.flip;let f=0;for(let d=1;d<=V.MAX_COINS;d++)for(let n=1;n<=d;n++){const g=e.probAtLeast(d,n),o=e.computeMultiplier(g);o>f&&(f=o)}return f},[]),ie=F*xe>E.maxPayout,ye=e=>{const d=performance.now()*.001,n=e.createRadialGradient(h/2,m/2,0,h/2,m/2,Math.max(h,m)/2);n.addColorStop(0,"rgba(26, 26, 46, 0.2)"),n.addColorStop(.5,"rgba(22, 33, 62, 0.15)"),n.addColorStop(1,"rgba(15, 15, 35, 0.1)"),e.fillStyle=n,e.fillRect(0,0,h,m),e.save(),e.globalAlpha=.15,e.fillStyle="rgba(212, 165, 116, 0.3)",e.font="120px serif",e.textAlign="center",e.save(),e.translate(h*.12,m*.15),e.rotate(-15*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(255, 215, 0, 0.25)",e.font="100px serif",e.save(),e.translate(h*.88,m*.85),e.rotate(25*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(139, 90, 158, 0.2)",e.font="60px serif",e.save(),e.translate(h*.75,m*.25),e.rotate(45*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.save(),e.translate(h*.25,m*.75),e.rotate(-30*Math.PI/180),e.fillText("ðŸª™",0,0),e.restore(),e.fillStyle="rgba(212, 165, 116, 0.15)",e.font="40px serif";const g=["ðŸª™","ðŸ’°","ðŸª™","ðŸ’°","ðŸª™","ðŸ’°"];for(let o=0;o<8;o++){const r=o*h/8+h/16,S=m*.3+Math.sin(o*.8)*60;e.save(),e.translate(r,S),e.rotate(o*45*Math.PI/180),e.fillText(g[o%g.length],0,0),e.restore()}if(e.restore(),i.enableEffects){e.strokeStyle="rgba(138, 43, 226, 0.3)",e.lineWidth=2;for(let o=0;o<8;o++){const r=i.enableMotion?(d*1+o*Math.PI/4)%(Math.PI*2):o*Math.PI/4,S=i.enableMotion?150+Math.sin(d*2+o)*50:150,w=h/2+Math.cos(r)*S,t=m/2+Math.sin(r)*S;e.beginPath(),e.arc(w,t,30+o*10,0,Math.PI*2),e.stroke()}}if(i.enableEffects){e.fillStyle="rgba(255, 215, 0, 0.6)",e.font="24px serif",e.textAlign="center";const o=["âœ¦","âœ§","âœ©","âœª","âœ«","âœ¬","âœ­","âœ®","âœ¯","âœ°"];for(let r=0;r<10;r++){const S=r*Math.PI/5,w=i.enableMotion?Math.sin(d*.1+r)*200+h/2:Math.cos(S)*200+h/2,t=i.enableMotion?Math.cos(d*.1+r)*150+m/2:Math.sin(S)*150+m/2;e.save(),e.translate(w,t);const s=i.enableMotion?d*1.5+r:r*.5;e.rotate(s),e.fillText(o[r%o.length],0,0),e.restore()}}i.enableEffects&&O>0&&ae.particles.forEach(o=>{const r=o.life/o.maxLife;e.save(),e.globalAlpha=r,e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fill(),e.restore()})},Se=e=>{me(e)},N=p.useCallback(()=>{const e=G.current;if(!e){l.current=requestAnimationFrame(N);return}const f=e.getContext("2d");if(!f){l.current=requestAnimationFrame(N);return}f.fillStyle=Xe.background,f.fillRect(0,0,h,m),ye(f),Se(f),l.current=requestAnimationFrame(N)},[c,I,W,ce,de,Q,x,oe,X,Y,i.enableMotion,ae.particles]);p.useEffect(()=>(N(),()=>{l.current&&cancelAnimationFrame(l.current)}),[N]);const Me=async()=>{if(!x){ee(!0);try{const f=q.flip.calculateBetArray(c,W,I),d=F*c;await y.play({bet:f,wager:d,metadata:[c,W,I==="heads"?1:0]});const n=await y.result();R.play("coin");const g=n.payout>0,o=[],r=[];for(let t=0;t<c;t++){const s=(n.resultIndex>>t&1)===1;o.push(s),r.push(s?1:0)}ue(r);const S=o.filter(t=>t===(I==="heads")).length;console.assert(S>=W===g,"Visual result does not match game result",{wins:S,atLeastK:W,actuallyWon:g}),await new Promise(t=>setTimeout(t,1500));const w={won:g,results:o,winnings:n.payout-d};g?(b.current&&(n.multiplier>=3?(b.current.winFlash("#ffd700",3),setTimeout(()=>{b.current?.particleBurst(void 0,void 0,"#ffd700",80),b.current?.screenShake(3,1500),K(h/2,m/2,"#ffd700")},300)):(b.current.winFlash("#4caf50",2),setTimeout(()=>{b.current?.particleBurst(void 0,void 0,"#4caf50",40),K(h/2,m/2,"#4caf50")},200))),R.play("win"),J(t=>t+w.winnings),B.updateStats(w.winnings)):(b.current&&(b.current.loseFlash("#f44336",2),setTimeout(()=>{b.current?.screenShake(2,1e3),K(h/2,m/2,"#ff6b6b")},200)),R.play("lose"),J(t=>t+w.winnings),B.updateStats(0)),fe(t=>t+1),pe(!0)}catch(e){console.error("Game error:",e)}finally{ee(!1)}}},re=()=>x?"Flipping...":Q?"Again":"Flip",le=()=>Me;return Oe("flip-v2"),a.jsxs(a.Fragment,{children:[a.jsx(H.Portal,{target:"recentplays",children:a.jsx(qe,{gameId:"flip-v2"})}),a.jsx(H.Portal,{target:"stats",children:a.jsx(Ue,{gameName:"Flip",gameMode:"V2",rtp:"95",stats:B.stats,onReset:B.resetStats,isMobile:C})}),a.jsx(H.Portal,{target:"screen",children:a.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"linear-gradient(135deg, #0a0511 0%, #0d0618 25%, #0f081c 50%, #0a0511 75%, #0a0511 100%)",perspective:"100px"},children:[a.jsx("div",{style:{position:"absolute",top:"20px",left:"20px",right:"20px",bottom:"140px",borderRadius:"10px",border:"2px solid rgba(212, 165, 116, 0.4)",overflow:"hidden"},children:a.jsx("canvas",{ref:G,width:h,height:m,style:{width:"100%",height:"100%",imageRendering:"auto",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent"}})}),a.jsxs(Ve,{children:[a.jsx("div",{style:{flex:"1",height:"100%",background:"linear-gradient(135deg, rgba(10, 5, 17, 0.9) 0%, rgba(139, 90, 158, 0.1) 50%, rgba(10, 5, 17, 0.9) 100%)",borderRadius:"12px",border:"2px solid rgba(212, 165, 116, 0.5)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"12px",boxShadow:"0 4px 16px rgba(10, 5, 17, 0.4), inset 0 1px 0 rgba(212, 165, 116, 0.2)",backdropFilter:"blur(10px)",position:"relative"},children:a.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"12px",width:"100%",alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[a.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"COINS"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[a.jsx("button",{onClick:()=>Z(Math.max(1,c-1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),a.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#ffffff",minWidth:"16px",textAlign:"center"},children:c}),a.jsx("button",{onClick:()=>Z(Math.min(V.MAX_COINS,c+1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[a.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"SIDE"}),a.jsx("button",{onClick:()=>k(I==="heads"?"tails":"heads"),disabled:x,style:{padding:"2px 8px",borderRadius:"6px",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#ffffff",fontSize:"11px",fontWeight:"bold",cursor:x?"not-allowed":"pointer"},children:I.charAt(0).toUpperCase()+I.slice(1)})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",minWidth:"60px"},children:[a.jsx("div",{style:{fontSize:"9px",fontWeight:"bold",color:"rgba(212, 165, 116, 0.8)",textAlign:"center"},children:"MIN SIDES"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[a.jsx("button",{onClick:()=>$(Math.max(1,W-1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),a.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#ffffff",minWidth:"16px",textAlign:"center"},children:W}),a.jsx("button",{onClick:()=>$(Math.min(c,W+1)),disabled:x,style:{width:"20px",height:"20px",borderRadius:"50%",border:"1px solid rgba(212, 165, 116, 0.5)",background:"rgba(10, 5, 17, 0.8)",color:"#d4a574",fontSize:"12px",fontWeight:"bold",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]})]})}),a.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(255, 152, 0, 0.15) 0%, rgba(245, 124, 0, 0.25) 50%, rgba(255, 152, 0, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(255, 152, 0, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(255, 152, 0, 0.2), inset 0 1px 0 rgba(255, 152, 0, 0.3)",backdropFilter:"blur(8px)"},children:[a.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#ff9800",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"RISK"}),a.jsx("div",{style:{fontSize:"18px",color:D()>.7?"#4caf50":D()>.3?"#ff9800":"#f44336",fontWeight:"600"},children:D()>.7?"LOW":D()>.3?"MEDIUM":"HIGH"})]}),a.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(184, 51, 106, 0.15) 0%, rgba(136, 14, 79, 0.25) 50%, rgba(184, 51, 106, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(184, 51, 106, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(184, 51, 106, 0.2), inset 0 1px 0 rgba(184, 51, 106, 0.3)",backdropFilter:"blur(8px)"},children:[a.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#b8336a",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"WIN CHANCE"}),a.jsxs("div",{style:{fontSize:"18px",color:"rgba(184, 51, 106, 0.9)",fontWeight:"600"},children:[(D()*100).toFixed(1),"%"]})]}),a.jsxs("div",{style:{flex:"0 0 140px",height:"100%",background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(46, 125, 50, 0.25) 50%, rgba(76, 175, 80, 0.15) 100%)",borderRadius:"12px",border:"2px solid rgba(76, 175, 80, 0.4)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",boxShadow:"0 4px 16px rgba(76, 175, 80, 0.2), inset 0 1px 0 rgba(76, 175, 80, 0.3)",backdropFilter:"blur(8px)"},children:[a.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#4caf50",textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",marginBottom:"4px"},children:"MULTIPLIER"}),a.jsx("div",{style:{fontSize:"18px",color:"rgba(76, 175, 80, 0.9)",fontWeight:"600"},children:`${be().toFixed(2)}x`})]})]}),a.jsx(Le,{ref:b,style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1e3}})]})}),a.jsxs(H.Portal,{target:"controls",children:[a.jsx(_e,{wager:F,setWager:j,onPlay:le(),playDisabled:x||!E||P.isPlaying||ie,playText:re()}),a.jsx(He,{onPlay:le(),playDisabled:x||!E||P.isPlaying||ie,playText:re(),children:a.jsx(Be,{value:F,onChange:j})})]})]})}export{dt as default};
